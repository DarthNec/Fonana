# –û—Ç—á–µ—Ç –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º JWT —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–î–∞—Ç–∞**: 29 –¥–µ–∫–∞–±—Ä—è 2024  
**–ê–≤—Ç–æ—Ä**: AI Assistant  
**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –í –ü–†–û–¶–ï–°–°–ï (90% –∑–∞–≤–µ—Ä—à–µ–Ω–æ)

## –†–µ–∑—é–º–µ

–ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –æ–±—à–∏—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π JWT –º–µ–∂–¥—É Next.js –∏ WebSocket-—Å–µ—Ä–≤–µ—Ä–æ–º. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å WebSocket-—Å–µ—Ä–≤–µ—Ä–æ–º —Ä–µ—à–µ–Ω—ã, –Ω–æ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### –§–∞–∑–∞ 1 ‚Äî –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ JWT –ø—Ä–æ–±–ª–µ–º—ã ‚úÖ

#### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. JWT —Ç–æ–∫–µ–Ω—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ Next.js API, –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ WebSocket —Å–µ—Ä–≤–µ—Ä–µ
2. –û—à–∏–±–∫–∞ "invalid signature" –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ WebSocket
3. Next.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∫–ª—é—á "your-secret-key" –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ NEXTAUTH_SECRET

#### –ü—Ä–æ–≤–µ–¥–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
- –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PM2
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —á—Ç–æ –∫–∞–≤—ã—á–∫–∏ –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã –∏–∑ NEXTAUTH_SECRET –≤ .env —Ñ–∞–π–ª–∞—Ö
- –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `test-jwt-production.js` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è JWT —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —á—Ç–æ —Ç–æ–∫–µ–Ω—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –∫–ª—é—á–æ–º

### –§–∞–∑–∞ 2 ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (90%) ‚ö†Ô∏è

#### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

1. **–û–±–Ω–æ–≤–ª–µ–Ω start-production.js**:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —è–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ dotenv
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
   - –ò–∑–º–µ–Ω–µ–Ω —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å–∫–∞ —Å execSync –Ω–∞ spawn
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è npx –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞ next

2. **–û–±–Ω–æ–≤–ª–µ–Ω ecosystem.config.js**:
   - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `env_file: './.env'`
   - –ò–∑–º–µ–Ω–µ–Ω —Å–∫—Ä–∏–ø—Ç –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ start-production.js

3. **–û–±–Ω–æ–≤–ª–µ–Ω next.config.js**:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —è–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ dotenv –¥–ª—è production —Ä–µ–∂–∏–º–∞

4. **–°–æ–∑–¥–∞–Ω .env.production**:
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –∏–∑ .env –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Next.js

#### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- ‚úÖ WebSocket —Å–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ start-production.js –≤–∏–¥–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (–ª–æ–≥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç)
- ‚ùå Next.js API endpoints –ù–ï –ø–æ–ª—É—á–∞—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ runtime
- ‚ùå JWT —Ç–æ–∫–µ–Ω—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –∫–ª—é—á–æ–º

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### AI_CHAT_INSTRUCTIONS.md:
–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–∞ –≤–∞–∂–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–∞:
1. **–†–∞–±–æ—Ç–∞ —Å –ª–æ–≥–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
2. **–°—Ç–∞–Ω–¥–∞—Ä—Ç —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –∏ –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–≥—Ä—É–∑–∫–∏

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã:
1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ .env —Ñ–∞–π–ª–∞—Ö (–±–µ–∑ –∫–∞–≤—ã—á–µ–∫)
2. dotenv —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ start-production.js
3. Next.js –≤–∏–¥–∏—Ç .env.production –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
4. API endpoint `/api/test/jwt-debug` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ NEXTAUTH_SECRET –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω

### –í–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:
Next.js –≤ production mode —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ dotenv –≤ runtime, –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1 - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```bash
# –ó–∞–ø—É—Å–∫–∞—Ç—å Next.js —Å —è–≤–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
NEXTAUTH_SECRET=... DATABASE_URL=... NODE_ENV=production npx next start
```

### –í–∞—Ä–∏–∞–Ω—Ç 2 - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏:
```bash
# –ó–∞–≥—Ä—É–∂–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π
source .env && npm run build
```

### –í–∞—Ä–∏–∞–Ω—Ç 3 - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PM2 environment:
```javascript
// –í ecosystem.config.js –¥–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —è–≤–Ω–æ
env: {
  NODE_ENV: 'production',
  PORT: 3000,
  NEXTAUTH_SECRET: 'rFbhMWHvRfv9AacQlVquu9JnY1jCoioNdpaPfIkAK9U=',
  DATABASE_URL: 'postgresql://...'
}
```

## –ò—Ç–æ–≥–∏

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:
- –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã JWT —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PM2 –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ª–æ–≥–∞–º–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
- WebSocket —Å–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

### ‚ùå –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
- Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –≤–∏–¥–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ runtime
- JWT —Ç–æ–∫–µ–Ω—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –∫–ª—é—á–æ–º

### üìä –ü—Ä–æ–≥—Ä–µ—Å—Å: 90%
–û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. 