# Исправление проблемы двойных путей изображений

## Дата: 26.12.2024

### Проблема:
В базе данных есть два поля для хранения изображений постов:
- `thumbnail` 
- `mediaUrl`

При создании поста оба поля заполнялись одинаковым значением, но при редактировании обновлялось только `mediaUrl`, оставляя старое значение в `thumbnail`.

### Симптомы:
1. После редактирования поста через `post-management` всё работало корректно
2. При редактировании через `feed`:
   - Модалка закрывалась при попытке загрузить новое изображение
   - Посты становились заблокированными для автора
   - Показывалось старое изображение (из `thumbnail`)
   - После обновления страницы показывалось новое изображение (из `mediaUrl`)

### Причины:
1. **Несинхронизированные поля**: При редактировании обновлялось только `mediaUrl`, но не `thumbnail`
2. **Разный порядок проверки**: В разных частях приложения использовался разный порядок:
   - Большинство мест: `mediaUrl || thumbnail`
   - `/creator/[id]/page.tsx`: `thumbnail || mediaUrl` (обратный порядок)
3. **Неполная очистка состояния**: При удалении медиа не учитывались оба поля

### Решение:

1. **components/EditPostModal.tsx**:
   - Синхронизация обоих полей при обновлении: `thumbnail: mediaUrl`
   - При загрузке нового файла оба поля получают одинаковое значение
   - При удалении медиа очищаются оба поля
   - Улучшена загрузка превью с учётом обоих полей

2. **app/creator/[id]/page.tsx**:
   - Исправлен порядок проверки на `mediaUrl || thumbnail` для консистентности

### Технические детали:
```javascript
// Было:
mediaUrl = uploadData.url

// Стало:
mediaUrl = uploadData.url
thumbnail = uploadData.url // Синхронизируем оба поля
```

### Статус: ✅ Исправлено

Теперь оба поля всегда синхронизированы, что исключает показ разных изображений в разных частях приложения. 