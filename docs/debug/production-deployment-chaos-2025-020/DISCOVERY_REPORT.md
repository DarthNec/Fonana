# üîç DISCOVERY REPORT: Production Deployment Chaos Analysis

**–ó–∞–¥–∞—á–∞**: –ü–æ–Ω—è—Ç—å –ø–æ—á–µ–º—É production —Å–∞–π—Ç —Å–ª–æ–º–∞–Ω –∏ –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –±–µ–∑ breaking changes  
**–î–∞—Ç–∞**: 2025-01-20  
**–°—Ç–∞—Ç—É—Å**: üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô - —Å–∞–π—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç  

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ù–ê–•–û–î–ö–ò

### 1. **STANDALONE BUILD MODE –ê–ö–¢–ò–í–ï–ù**
```bash
# PM2 –∑–∞–ø—É—Å–∫–∞–µ—Ç standalone server
script path: /var/www/Fonana/.next/standalone/server.js

# –ù–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –Ω–µ —Å–ª—É–∂–∞—Ç—Å—è:
HTTP/1.1 404 Not Found –¥–ª—è /_next/static/chunks/*.js
```

### 2. **–î–í–û–ô–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø NGINX**
```nginx
# –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç—Å—è –Ω–∞ localhost:3000
location / {
    proxy_pass http://127.0.0.1:3000;
}
# –ù–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ serving –¥–ª—è /_next/static/
```

### 3. **–ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï BUILD –ú–ï–¢–û–î–ê**
```bash
# –í—ã–ø–æ–ª–Ω—è–ª–∏: npm run build (–æ–±—ã—á–Ω—ã–π build)
# PM2 –æ–∂–∏–¥–∞–µ—Ç: standalone build —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º static serving
```

## üìä PLAYWRIGHT MCP –ù–ê–•–û–î–ö–ò

### Console Errors (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ):
- ‚ùå `Failed to load resource: 404` –¥–ª—è CSS –∏ JS chunks
- ‚ùå `Refused to execute script` - CSP –±–ª–æ–∫–∏—Ä—É–µ—Ç
- ‚ùå `Refused to apply style` - MIME type –æ—à–∏–±–∫–∏

### Network Analysis:
- ‚úÖ HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (200 OK)
- ‚ùå –í—Å–µ `/_next/static/*` —Ä–µ—Å—É—Ä—Å—ã = 404
- ‚ùå JavaScript –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è ‚Üí React –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üîç –ê–ù–ê–õ–ò–ó –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –†–ï–®–ï–ù–ò–ô

### A. **–õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ** (—Ä–∞–±–æ—Ç–∞–µ—Ç):
- `npm run dev` - development server
- Serving —á–µ—Ä–µ–∑ Next.js dev server –Ω–∞ localhost:3000

### B. **Production –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** (—Å–ª–æ–º–∞–Ω–æ):
- PM2 ‚Üí standalone server
- Nginx ‚Üí proxy_pass –∫ localhost:3000
- **–ü–†–û–ë–õ–ï–ú–ê**: standalone –Ω–µ serves static files —Å–∞–º

### C. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π production setup** (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å):
```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: Standalone + Nginx static
standalone build + nginx serves /_next/static/

# –í–∞—Ä–∏–∞–Ω—Ç 2: Normal build + PM2
npm run build + pm2 start npm -- start + nginx proxy

# –í–∞—Ä–∏–∞–Ω—Ç 3: Standalone –ø–æ–ª–Ω—ã–π
standalone build + –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ static –≤ nginx root
```

## üîÑ –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´ –•–ê–û–°–ê

1. **–ö—Ç–æ-—Ç–æ —Ä–∞–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–∏–ª standalone** –±–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
2. **–°–º–µ—à–∞–ª–∏ –¥–≤–∞ –ø–æ–¥—Ö–æ–¥–∞**: normal build –∫–æ–º–∞–Ω–¥—ã + standalone PM2 config
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** –ø–æ deployment –ø—Ä–æ—Ü–µ—Å—Å—É
4. **–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–∫—Å—ã –±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞** (–∫–∞–∫ —è —Ç–æ–ª—å–∫–æ —á—Ç–æ –¥–µ–ª–∞–ª ü§¶‚Äç‚ôÇÔ∏è)

## ‚ö° –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –ù–ê–•–û–î–ö–ò (Playwright MCP)

### Homepage (https://fonana.me):
```yaml
Status: –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è HTML, –Ω–æ –±–µ–∑ —Å—Ç–∏–ª–µ–π/JS
Errors: 8+ failed resources (CSS, JS chunks)
Visual: –ë–µ–ª–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –±–∞–∑–æ–≤—ã–º HTML
```

### Static Resources:
```bash
# –§–∞–π–ª—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
/var/www/Fonana/.next/static/chunks/3513-e74e0943a2287f8d.js ‚úÖ

# –ù–æ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ HTTP:
curl http://localhost:3000/_next/static/chunks/3513-e74e0943a2287f8d.js ‚Üí 404 ‚ùå
```

## üéØ –ö–õ–Æ–ß–ï–í–´–ï –í–û–ü–†–û–°–´ –î–õ–Ø –†–ï–®–ï–ù–ò–Ø

1. **–ö—Ç–æ –∏ –∫–æ–≥–¥–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–ª standalone mode?** 
2. **–ï—Å—Ç—å –ª–∏ next.config.js —Å output: 'standalone'?**
3. **–ü–æ—á–µ–º—É nginx –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è static files?**
4. **–ö–∞–∫–æ–π –±—ã–ª –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–π working deployment?**

## üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò (–ù–ï –ö–û–î–ò–¢–¨ –ï–©–ï!)

1. ‚úÖ **DISCOVERY –∑–∞–≤–µ—Ä—à–µ–Ω** - –ø—Ä–æ–±–ª–µ–º–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞
2. üîÑ **ARCHITECTURE_CONTEXT** - –∫–∞—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. üîÑ **IDENTIFY root cause** - standalone vs normal build conflict
4. üîÑ **SOLUTION_PLAN** - –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑ breaking changes

## üö´ –ß–¢–û –ù–ï –î–ï–õ–ê–¢–¨

- ‚ùå –ù–µ –º–µ–Ω—è—Ç—å PM2 –∫–æ–Ω—Ñ–∏–≥ —Å–ª—É—á–∞–π–Ω–æ
- ‚ùå –ù–µ —Ç—Ä–æ–≥–∞—Ç—å nginx –±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞
- ‚ùå –ù–µ –¥–µ–ª–∞—Ç—å `npm run build` –ø–æ–∫–∞ –Ω–µ –ø–æ–Ω–∏–º–∞–µ–º –∫–æ–Ω—Ñ–∏–≥
- ‚ùå –ù–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –±–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## ‚úÖ –í–´–í–û–î–´

**–ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**: Standalone server –∑–∞–ø—É—â–µ–Ω, –Ω–æ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è serving static files.  
**–†–ï–®–ï–ù–ò–ï –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï**: –õ–∏–±–æ –¥–æ–¥–µ–ª–∞—Ç—å standalone setup, –ª–∏–±–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ normal build.  
**–†–ò–°–ö**: –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç —Å–ª–æ–º–∞—Ç—å —Ä–∞–±–æ—á–∏–µ —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã.

---
**NEXT**: –°–æ–∑–¥–∞—Ç—å ARCHITECTURE_CONTEXT.md –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∫–∞—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è deployment 