# üö® –ò–î–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø –ü–†–û–ë–õ–ï–ú: MESSENGER SYSTEM

## üìÖ –î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: 18.01.2025
## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –û–ë–ù–ê–†–£–ñ–ï–ù–´

## üîç –°–ò–°–¢–ï–ú–ù–´–ô –°–¢–ê–¢–£–°

### ‚úÖ –†–ê–ë–û–¢–ê–Æ–©–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´:
- **Frontend —Å–µ—Ä–≤–µ—Ä**: ‚úÖ –ó–∞–ø—É—â–µ–Ω –Ω–∞ localhost:3000
- **API Backend**: ‚úÖ –û—Ç–≤–µ—á–∞–µ—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏
- **Database**: ‚úÖ PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω, 59 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **JWT Manager**: ‚úÖ –õ–æ–≥–∏–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è
- **AppProvider**: ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### ‚ùå –ü–†–û–ë–õ–ï–ú–ù–´–ï –û–ë–õ–ê–°–¢–ò:

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #1: PRISMA SCHEMA MISMATCH

**–°—Ç–∞—Ç—É—Å**: üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞

**–°–∏–º–ø—Ç–æ–º**: –í –ª–æ–≥–∞—Ö terminal –≤–∏–¥–Ω–æ:
```
Unknown field `messages` for include statement on model `Conversation`
```

**–ê–Ω–∞–ª–∏–∑**:
1. **API route** –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `include: { messages: ... }`
2. **Prisma schema** –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç relation `messages` –≤ –º–æ–¥–µ–ª–∏ `Conversation`
3. **Prisma Client** –Ω–µ –±—ã–ª –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è Prisma —Å—Ö–µ–º–∞ —Å API –∫–æ–¥–æ–º

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #2: INFINITE API LOOPS

**–°—Ç–∞—Ç—É—Å**: üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô - —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É

**–°–∏–º–ø—Ç–æ–º**: –í terminal –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä—ã:
```
[Conversations API] Starting GET request
[Conversations API] Token verified: cmbymuez00004qoe1aeyoe7zf
[Conversations API] User found: cmbymuez00004qoe1aeyoe7zf lafufu
```

**–ê–Ω–∞–ª–∏–∑**:
1. **Frontend** –¥–µ–ª–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API
2. **API** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å, –Ω–æ **Prisma –æ—à–∏–±–∫–∞** –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç
3. **Frontend** –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É –∫–∞–∫ —Å–µ—Ç–µ–≤—É—é –∏ **–ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å**
4. **–û–±—Ä–∞–∑—É–µ—Ç—Å—è infinite loop**

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –û—à–∏–±–∫–∞ Prisma –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ retry –ª–æ–≥–∏–∫–µ

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê #3: AVATAR COMPONENT ERRORS

**–°—Ç–∞—Ç—É—Å**: üü° –í–ê–ñ–ù–ê–Ø - –≤–ª–∏—è–µ—Ç –Ω–∞ UX

**–°–∏–º–ø—Ç–æ–º**: JavaScript –æ—à–∏–±–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
Image with src "/media/avatars/avatar_*.jpeg" has invalid "width" property. 
Expected a numeric value in pixels but received "medium".
```

**–ê–Ω–∞–ª–∏–∑**:
1. **MessagesPageClient** –ø–µ—Ä–µ–¥–∞–µ—Ç `size="medium"` –≤ Avatar
2. **Avatar component** –æ–∂–∏–¥–∞–µ—Ç `size: number`
3. **Next.js Image** –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç—Ä–æ–∫—É –∫–∞–∫ width

**–°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (size="medium" ‚Üí size={48})

## üìä –í–õ–ò–Ø–ù–ò–ï –ù–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "lafufu":
- ‚úÖ JWT —Ç–æ–∫–µ–Ω —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚ùå API conversations –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Prisma –æ—à–∏–±–∫—É
- ‚ùå –°–ø–∏—Å–æ–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "fonanadev":  
- ‚úÖ JWT —Ç–æ–∫–µ–Ω —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚ùå API conversations –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Prisma –æ—à–∏–±–∫—É
- ‚ùå –°–ø–∏—Å–æ–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –ü–†–ò–û–†–ò–¢–ï–¢ 1 (–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô):
1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Prisma schema** - –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ relations
2. **–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma Client**
3. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å infinite loops**

### –ü–†–ò–û–†–ò–¢–ï–¢ 2 (–í–ê–ñ–ù–´–ô):
1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å JWT flow** —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ö–µ–º–æ–π
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API responses**  
3. **–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å frontend rendering**

### –ü–†–ò–û–†–ò–¢–ï–¢ 3 (–ñ–ï–õ–ê–¢–ï–õ–¨–ù–´–ô):
1. **–î–æ–±–∞–≤–∏—Ç—å error boundaries**
2. **–£–ª—É—á—à–∏—Ç—å error messaging**
3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å retry –ª–æ–≥–∏–∫—É**

## üîß –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –®–ê–ì 1: PRISMA SCHEMA FIX
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ relations –≤ schema.prisma
-- –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è messages –≤ Conversation
-- –î–æ–±–∞–≤–∏—Ç—å conversation field –≤ Message
```

### –®–ê–ì 2: REGENERATE & RESTART
```bash
npx prisma generate
pkill -f "next dev" 
npm run dev
```

### –®–ê–ì 3: VALIDATION TESTING
```bash
# Test API endpoint
curl -H "Authorization: Bearer <token>" http://localhost:3000/api/conversations

# Test frontend behavior
# Check browser console for errors
```

## ‚ö° –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ API conversations –≤–µ—Ä–Ω–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ Infinite loops –ø—Ä–µ–∫—Ä–∞—Ç—è—Ç—Å—è
- ‚úÖ Frontend –ø–æ–∫–∞–∂–µ—Ç —Å–ø–∏—Å–æ–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤  
- ‚úÖ –û–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä

## üìù –ó–ê–ú–ï–¢–ö–ò

- **Root cause**: –ü—Ä–æ–±–ª–µ–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è, –Ω–µ –≤ –ª–æ–≥–∏–∫–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **Impact**: –ü–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Complexity**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–µ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
- **Testing**: –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ 