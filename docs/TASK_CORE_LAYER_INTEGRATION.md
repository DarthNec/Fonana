## üß± [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Å–ª–æ—ë–≤: WebSocketEventManager, CacheManager, Retry –ª–æ–≥–∏–∫–∞]

### –ö–æ–Ω—Ç–µ–∫—Å—Ç
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏ (WebSocketEventManager, CacheManager, Retry –ª–æ–≥–∏–∫–∞) —Å–æ–∑–¥–∞–Ω—ã, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –û–¥–Ω–∞–∫–æ –æ–Ω–∏ **–Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–¥** –ø—Ä–æ–µ–∫—Ç–∞: —Ö—É–∫–∏, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ API –≤—ã–∑–æ–≤—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É. –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ä–∞–∑—Ä—ã–≤ –∏ –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º –∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–º.

### –¶–µ–ª—å
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥:
- –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã WebSocket –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–±—ã—Ç–∏–π
- –ó–∞–º–µ–Ω–∏—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ localStorage –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CacheManager
- –û–±–µ—Ä–Ω—É—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ async –≤—ã–∑–æ–≤—ã –≤ retry-–ª–æ–≥–∏–∫—É

---

### –†–æ–∞–¥–º–∞–ø

#### –≠—Ç–∞–ø 1: WebSocketEventManager - ‚úÖ –ß–ê–°–¢–ò–ß–ù–û –ó–ê–í–ï–†–®–ï–ù
- [x] ‚úÖ –ù–∞–π—Ç–∏ –≤—Å–µ –≤—ã–∑–æ–≤—ã `wsService.emit(...)` –∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞:
```ts
import { emitPostLiked } from '@/lib/services/WebSocketEventManager'
emitPostLiked(postId, likesCount, userId)
```
- [x] ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å `wsService.on(...)` –Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ `setupDefaultHandlers()` –≤ `AppProvider`
- [x] ‚úÖ –£–¥–∞–ª–∏—Ç—å –ø—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `wsService` –≤ —Ö—É–∫–∞—Ö –∏ UI

#### –≠—Ç–∞–ø 2: CacheManager - ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù
- [x] ‚ö†Ô∏è –ù–∞–π—Ç–∏ –∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã `localStorage.getItem(...)`, `setItem(...)`, `removeItem(...)`
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:
```ts
import { cacheManager } from '@/lib/services/CacheManager'
const cachedUser = cacheManager.get('user_data')
cacheManager.set('user_data', newUserData)
```
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `AppProvider`, `Feed`, `Profile`, `CreatorPage`, `SubscriptionManager` –∏ —Ç.–¥.

#### –≠—Ç–∞–ø 3: Retry –ª–æ–≥–∏–∫–∞ - ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–ê
- [x] ‚ö†Ô∏è –ù–∞–π—Ç–∏ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ async –≤—ã–∑–æ–≤—ã, —Ç–∞–∫–∏–µ –∫–∞–∫:
  - `fetchUserData()`
  - `fetchNotifications()`
  - `POST /like`
  - `POST /comment`
- [ ] –û–±–µ—Ä–Ω—É—Ç—å –∏—Ö –≤:
```ts
import { retryWithToast } from '@/lib/utils/retry'
await retryWithToast(() => fetchUserData(), config, 'UserData')
```
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è toast, UI fallback –∏–ª–∏ retry-UI

---

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

‚úÖ –í—Å–µ `wsService.emit/on` —É–¥–∞–ª–µ–Ω—ã –∏–∑ UI –∏ —Ö—É–∫–æ–≤  
‚úÖ –í—Å–µ –∫–µ—à–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `CacheManager`  
‚úÖ –í—Å–µ –≤–∞–∂–Ω—ã–µ async –≤—ã–∑–æ–≤—ã –ø–æ–∫—Ä—ã—Ç—ã `retry(...)` –∏–ª–∏ `retryWithToast(...)`  
‚úÖ –í–µ—Å—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥ —É–¥–∞–ª—ë–Ω, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –æ—Å–Ω–æ–≤–∞ –ø—Ä–æ–µ–∫—Ç–∞  
‚úÖ –í–æ–∑–º–æ–∂–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–ª–æ—ë–≤

---

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

- [ ] –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ö—É–∫–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑ `wsService`
- [ ] –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –∫–µ—à—É —á–µ—Ä–µ–∑ `cacheManager`
- [ ] Retry –ª–æ–≥–∏–∫–∞ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–æ—á–∫–∞—Ö API
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ `Fonana_Architecture.md`, `Fonana_Context_Flows.md`, `REFACTORING_PROGRESS_REPORT.md` –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

---

### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
‚è±Ô∏è –ü—Ä–∏–º–µ—Ä–Ω–æ 2‚Äì3 —á–∞—Å–∞

---

### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
‚ùó –≠—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —ç—Ç–∞–ø  
‚ùó –ë–µ–∑ –Ω–µ–≥–æ –ø—Ä–æ–µ–∫—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ ¬´—Ñ–µ–π–∫–æ–≤–æ–π¬ª –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ  
‚ùó –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–æ–∂–Ω–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –Ω–∞—á–∏–Ω–∞—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ