# üìã SOLUTION PLAN v1: Database Migration Implementation

**–î–∞—Ç–∞**: 2025-01-16  
**–í–µ—Ä—Å–∏—è**: v1  
**–ó–∞–¥–∞—á–∞**: –ò–º–ø–æ—Ä—Ç –¥–∞–º–ø–∞ Supabase –≤ –ª–æ–∫–∞–ª—å–Ω—É—é PostgreSQL  
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è**: IDEAL_METHODOLOGY.md

## üéØ –¶–µ–ª—å —Ä–µ—à–µ–Ω–∏—è

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü `/feed` –∏ `/creators` –ø—É—Ç–µ–º –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Supabase –¥–∞–º–ø–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã API endpoints.

## üîç –ö–ª—é—á–µ–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç–∏—è

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ü–£–°–¢–ê**: –¢–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞–Ω—ã (`relation "users" does not exist`)
- **isCreator —Ñ–ª–∞–≥**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –í–°–ï–• API endpoints –¥–ª—è creators (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)

### üìä –ê–Ω–∞–ª–∏–∑ –¥–∞–º–ø–∞:
- 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ `isCreator` —Ñ–ª–∞–≥–∞
- 10 –ø–æ—Å—Ç–æ–≤ –±–µ–∑ `content` –ø–æ–ª—è  
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ª–∞–π–∫–∏, –ø–æ–¥–ø–∏—Å–∫–∏

## üìù –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏

### **–≠–¢–ê–ü 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** ‚è±Ô∏è 5 –º–∏–Ω
```bash
# 1.1 –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ Prisma (—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã)
npx prisma migrate deploy

# 1.2 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
PGPASSWORD=postgres psql -h localhost -U postgres -d fonana_dev -c "\dt"

# 1.3 –°–æ–∑–¥–∞—Ç—å backup —Ç–æ—á–∫—É
PGPASSWORD=postgres pg_dump -h localhost -U postgres fonana_dev > backup_empty_$(date +%Y%m%d_%H%M%S).sql
```

### **–≠–¢–ê–ü 2: –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö** ‚è±Ô∏è 3 –º–∏–Ω
```bash
# 2.1 –ò–º–ø–æ—Ä—Ç SQL –¥–∞–º–ø–∞
PGPASSWORD=postgres psql -h localhost -U postgres -d fonana_dev -f import-sample-data.sql

# 2.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–∞
PGPASSWORD=postgres psql -h localhost -U postgres -d fonana_dev -c "
SELECT COUNT(*) as users_imported FROM users;
SELECT COUNT(*) as posts_imported FROM posts;
SELECT nickname, wallet FROM users LIMIT 3;
"
```

### **–≠–¢–ê–ü 3: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** ‚è±Ô∏è 5 –º–∏–Ω
```sql
-- 3.1 –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å isCreator=true –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ—Å—Ç–∞–º–∏
UPDATE users 
SET "isCreator" = true 
WHERE id IN (
  SELECT DISTINCT "creatorId" FROM posts WHERE "creatorId" IS NOT NULL
);

-- 3.2 –î–æ–±–∞–≤–∏—Ç—å –±–∞–∑–æ–≤—ã–π content –¥–ª—è –ø–æ—Å—Ç–æ–≤ (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
UPDATE posts 
SET content = title || ' - Imported from Supabase'
WHERE content IS NULL OR content = '';

-- 3.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
SELECT nickname, "isCreator" FROM users WHERE "isCreator" = true;
SELECT title, content FROM posts LIMIT 3;
```

### **–≠–¢–ê–ü 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API** ‚è±Ô∏è 5 –º–∏–Ω
```bash
# 4.1 –¢–µ—Å—Ç API creators
curl "http://localhost:3000/api/creators" | jq '.creators | length'

# 4.2 –¢–µ—Å—Ç API posts  
curl "http://localhost:3000/api/posts" | jq '.posts | length'

# 4.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–∞–Ω–Ω—ã–µ, –Ω–µ –ø—É—Å—Ç—ã–µ –º–∞—Å—Å–∏–≤—ã)
```

### **–≠–¢–ê–ü 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Frontend** ‚è±Ô∏è 10 –º–∏–Ω
```typescript
// 5.1 –û—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
http://localhost:3000/creators  // –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
http://localhost:3000/feed      // –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ—Å—Ç—ã

// 5.2 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
// 5.3 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
```

## üîß Context7 –ø—Ä–æ–≤–µ—Ä–∫–∏

### **Prisma ORM**:
- ‚úÖ –í–µ—Ä—Å–∏—è 5.22.0 —Å—Ç–∞–±–∏–ª—å–Ω–∞  
- ‚úÖ PostgreSQL provider –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `prisma migrate deploy`

### **PostgreSQL**:
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Connection string –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã psql —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç

## üöÄ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã

### **–ü–æ–¥—Ö–æ–¥ A: –ü—Ä—è–º–æ–π SQL –∏–º–ø–æ—Ä—Ç** ‚úÖ –í–´–ë–†–ê–ù
- **–ü–ª—é—Å—ã**: –ë—ã—Å—Ç—Ä–æ, –ø—Ä–æ—Å—Ç–æ, –Ω–∞–¥–µ–∂–Ω–æ
- **–ú–∏–Ω—É—Å—ã**: –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ
- **–†–∏—Å–∫**: –ù–∏–∑–∫–∏–π

### **–ü–æ–¥—Ö–æ–¥ B: –°–∫—Ä–∏–ø—Ç supabase-to-local.sh**
- **–ü–ª—é—Å—ã**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
- **–ú–∏–Ω—É—Å—ã**: –¢—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ Supabase, —Å–ª–æ–∂–Ω–µ–µ debug
- **–†–∏—Å–∫**: –°—Ä–µ–¥–Ω–∏–π

### **–ü–æ–¥—Ö–æ–¥ C: –°–æ–∑–¥–∞–Ω–∏–µ seed —Å–∫—Ä–∏–ø—Ç–∞**  
- **–ü–ª—é—Å—ã**: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–ú–∏–Ω—É—Å—ã**: –ú–Ω–æ–≥–æ —Ä–∞–±–æ—Ç—ã, –Ω–µ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–†–∏—Å–∫**: –ù–∏–∑–∫–∏–π, –Ω–æ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### **Quantifiable Goals**:
1. **Database**: 10 users + 10 posts –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã ‚úÖ
2. **API Response Time**: `/api/creators` < 500ms ‚è±Ô∏è
3. **Frontend Loading**: –°—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ ‚úÖ
4. **Creator Detection**: isCreator=true –¥–ª—è –≤—Å–µ—Ö –∞–≤—Ç–æ—Ä–æ–≤ ‚úÖ
5. **Zero Errors**: –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –±–µ–∑ –æ—à–∏–±–æ–∫ ‚úÖ

### **Success Criteria**:
- `/creators` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–µ "No creators")
- `/feed` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤ (–Ω–µ "Loading posts...")  
- API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (–Ω–µ –ø—É—Å—Ç—ã–µ –º–∞—Å—Å–∏–≤—ã)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ä–∞–±–æ—Ç–∞–µ—Ç

## üîÑ Rollback Plan

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫:
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup
PGPASSWORD=postgres psql -h localhost -U postgres -d fonana_dev < backup_empty_TIMESTAMP.sql

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã
npx prisma migrate reset --force
```

## üìã –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã

1. ‚úÖ SOLUTION_PLAN.md v1 –∑–∞–≤–µ—Ä—à–µ–Ω
2. ‚è≥ –°–æ–∑–¥–∞—Ç—å IMPACT_ANALYSIS.md v1  
3. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∏—Å–∫–∏ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
4. ‚è≥ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ü–∏–∫–ª –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
5. ‚è≥ –ü–æ–ª—É—á–∏—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏–µ –Ω–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—é

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ª–∞–π–∫–∏
- –ü–æ–¥–ø–∏—Å–∫–∏ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏  
- –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã –¥–ª—è –ø–æ—Å—Ç–æ–≤
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–µ–≥–∏ 