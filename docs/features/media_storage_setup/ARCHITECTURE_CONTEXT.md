# üèóÔ∏è ARCHITECTURE CONTEXT: Media Storage Setup

## üìÖ –î–∞—Ç–∞: 18.01.2025
## üéØ –ó–∞–¥–∞—á–∞: –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–µ–¥–∏–∞-—Ö—Ä–∞–Ω–µ–Ω–∏—è

## üîç –¢–ï–ö–£–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### 1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –º–µ–¥–∏–∞

#### Avatar.tsx
```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç dicebear.com –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SVG –∞–≤–∞—Ç–∞—Ä–æ–≤
const avatarUrl = `https://api.dicebear.com/9.x/avataaars/svg?seed=${seed}&backgroundColor=${backgroundColor}`;

// –¢–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
if (src) {
  return <img src={src} alt={alt} />;
}
```

#### PostCard –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```typescript
// –û–∂–∏–¥–∞—é—Ç –º–µ–¥–∏–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:
post.thumbnail // URL –ø—Ä–µ–≤—å—é
post.mediaUrl  // URL –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```

#### CreatorCard –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```typescript
// –ò—Å–ø–æ–ª—å–∑—É—é—Ç –ø–æ–ª—è:
creator.avatar         // URL –∞–≤–∞—Ç–∞—Ä–∞
creator.backgroundImage // URL —Ñ–æ–Ω–∞ (–ù–ï –°–£–©–ï–°–¢–í–£–ï–¢ –≤ –ë–î)
```

### 2. –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –º–µ–¥–∏–∞

```mermaid
flowchart TD
    DB[PostgreSQL] --> API[API Routes]
    API --> Normalizer[PostNormalizer]
    Normalizer --> Frontend[React Components]
    
    Frontend --> Render{–†–µ–Ω–¥–µ—Ä–∏–Ω–≥}
    Render -->|–ê–≤–∞—Ç–∞—Ä –µ—Å—Ç—å| LocalImage[–õ–æ–∫–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ]
    Render -->|–ê–≤–∞—Ç–∞—Ä–∞ –Ω–µ—Ç| DiceBear[dicebear.com SVG]
    Render -->|–ú–µ–¥–∏–∞ –ø–æ—Å—Ç–∞| Supabase404[404 Not Found]
```

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î

#### –¢–∞–±–ª–∏—Ü–∞ users
```sql
avatar VARCHAR(255) -- –•—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –∏–º—è —Ñ–∞–π–ª–∞: "avatar_TIMESTAMP_RANDOM.ext"
-- –ù–ï–¢ –ø–æ–ª—è backgroundImage
```

#### –¢–∞–±–ª–∏—Ü–∞ posts
```sql
thumbnail TEXT -- –ü–æ–ª–Ω—ã–π URL: "https://iwzfrnfemdeomowothhn.supabase.co/storage/v1/object/public/posts/..."
mediaUrl TEXT  -- –ü–æ–ª–Ω—ã–π URL: "https://iwzfrnfemdeomowothhn.supabase.co/storage/v1/object/public/posts/..."
```

### 4. –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
public/
‚îú‚îÄ‚îÄ posts/
‚îÇ   ‚îî‚îÄ‚îÄ images/      # 6 —Ñ–∞–π–ª–æ–≤ –∏–∑ ~300 –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö
‚îú‚îÄ‚îÄ placeholder.jpg  # –û–±—â–∏–π placeholder
‚îú‚îÄ‚îÄ placeholder-video.png
‚îú‚îÄ‚îÄ placeholder-audio.png
‚îî‚îÄ‚îÄ [–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ avatar_*.jpeg —Ñ–∞–π–ª—ã]
```

### 5. API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### GET /api/creators
```typescript
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–µ–∞—Ç–æ—Ä–æ–≤ —Å –ø–æ–ª–µ–º avatar
// –ù–ï –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º
```

#### GET /api/posts
```typescript
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å—Ç—ã —Å thumbnail –∏ mediaUrl
// PostNormalizer –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
```

### 6. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

#### Frontend –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–∂–∏–¥–∞—é—Ç —Ä–∞–±–æ—Ç–∞—é—â–∏–µ URL
- –ù–µ—Ç fallback –º–µ—Ö–∞–Ω–∏–∑–º–∞ –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ù–µ—Ç lazy loading –∏–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### Backend –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- PostgreSQL —Ö—Ä–∞–Ω–∏—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ —Ä–µ—Å—É—Ä—Å—ã
- –ù–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ–¥–∏–∞

#### –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- dicebear.com –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞–≤–∞—Ç–∞—Ä–æ–≤
- Supabase Storage (–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)

## üîó –ü–ê–¢–¢–ï–†–ù–´ –ò –ü–†–ê–ö–¢–ò–ö–ò

### –¢–µ–∫—É—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
1. **Mixed Storage**: –ê–≤–∞—Ç–∞—Ä—ã –ª–æ–∫–∞–ª—å–Ω–æ, –ø–æ—Å—Ç—ã –≤ Supabase
2. **No Validation**: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤
3. **External Dependencies**: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç dicebear.com
4. **Inconsistent Paths**: –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –ø—É—Ç–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –º–µ–¥–∏–∞

### –ü—Ä–æ–±–ª–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
1. **Data Loss**: –ú–µ–¥–∏–∞-—Ñ–∞–π–ª—ã –Ω–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å Supabase
2. **Schema Mismatch**: Frontend –æ–∂–∏–¥–∞–µ—Ç –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –ë–î
3. **No Fallbacks**: –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤
4. **Performance**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ 404 –∑–∞–ø—Ä–æ—Å—ã –∑–∞–º–µ–¥–ª—è—é—Ç –∑–∞–≥—Ä—É–∑–∫—É

## üìä –ê–ù–ê–õ–ò–ó –í–õ–ò–Ø–ù–ò–Ø

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **Avatar.tsx**: –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (dicebear fallback)
- **PostCard**: –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–¥–∏–∞ (404)
- **CreatorCard**: –ù–µ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ–Ω—ã
- **Feed —Å—Ç—Ä–∞–Ω–∏—Ü–∞**: –í–∏–∑—É–∞–ª—å–Ω–æ —Å–ª–æ–º–∞–Ω–∞
- **Creator –ø—Ä–æ—Ñ–∏–ª–∏**: –ù–µ–ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å
- üî¥ **–í—ã—Å–æ–∫–∞—è**: –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (–ø–æ—Å—Ç—ã) –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- üü° **–°—Ä–µ–¥–Ω—è—è**: –ê–≤–∞—Ç–∞—Ä—ã —á–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç
- üü¢ **–ù–∏–∑–∫–∞—è**: –°–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–∞–¥–∞–µ—Ç, —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ê–ù–ê–õ–ò–ó–ê

- [x] –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –º–µ–¥–∏–∞, –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã?
- [x] –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Å–ª–µ–∂–µ–Ω –æ—Ç –ë–î –¥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞?
- [x] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —É—á—Ç–µ–Ω—ã?
- [x] –ü—Ä–æ–±–ª–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≤—ã—è–≤–ª–µ–Ω—ã?
- [x] –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–∏—Å—Ç–µ–º—É –æ—Ü–µ–Ω–µ–Ω–æ?

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. –°–æ–∑–¥–∞—Ç—å SOLUTION_PLAN.md —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ø–ª–∞–Ω–æ–º —Ä–µ—à–µ–Ω–∏—è
2. –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏ –º–µ–¥–∏–∞
3. –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
4. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ 