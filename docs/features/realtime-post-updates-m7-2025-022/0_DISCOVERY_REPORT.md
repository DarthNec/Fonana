# üìã DISCOVERY REPORT: Real-time Post Updates –¥–ª—è –ê–≤—Ç–æ—Ä–∞

**–î–∞—Ç–∞:** 22.01.2025  
**–ó–∞–¥–∞—á–∞:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–µ–Ω—Ç—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∞ –ø–æ—Å—Ç–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏  
**M7 Phase:** 0 - Discovery

## üîç –ü–†–û–ë–õ–ï–ú–ê

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ –∞–≤—Ç–æ—Ä –≤–∏–¥–∏—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —É—Å–ø–µ—à–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- –õ–µ–Ω—Ç–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (`refresh()`) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞  
- –ê–≤—Ç–æ—Ä –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ª–µ–Ω—Ç—ã

**–ñ–µ–ª–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ê–≤—Ç–æ—Ä —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç —Å–≤–æ–π –Ω–æ–≤—ã–π –ø–æ—Å—Ç –≤ –ª–µ–Ω—Ç–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ API –æ—Ç–≤–µ—Ç–∞
- –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞ –≤ —Ç–æ–ø–µ –ª–µ–Ω—Ç—ã

## üéØ SCOPE & REQUIREMENTS

### Functional Requirements
1. **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ù–æ–≤—ã–π –ø–æ—Å—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –ª–µ–Ω—Ç–µ –∞–≤—Ç–æ—Ä–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 100-300ms –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
2. **UI/UX –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –ü–æ—Å—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å —Ç–µ–º–∏ –∂–µ –¥–∞–Ω–Ω—ã–º–∏, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç API
3. **Error handling:** Graceful fallback –µ—Å–ª–∏ real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ
4. **Performance:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π impact –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–µ–Ω—Ç—ã

### Non-Functional Requirements
1. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ WebSocket –∏ real-time —Å–∏—Å—Ç–µ–º–∞–º–∏
2. **Scalability:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **Maintainability:** –ù–µ –Ω–∞—Ä—É—à–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø–æ—Å—Ç–æ–≤ –∏ –ª–µ–Ω—Ç—ã

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–û–ï –ò–°–°–õ–ï–î–û–í–ê–ù–ò–ï

### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è WebSocket Infrastructure

**WebSocket Server (–ø–æ—Ä—Ç 3002):**
```typescript
// websocket-server/src/server.js
- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚úÖ
- Channel-based subscriptions ‚úÖ
- –°–æ–±—ã—Ç–∏—è: post_created, post_liked, feed_update ‚úÖ
- Redis pub/sub –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è ‚úÖ

// Events system
websocket-server/src/events/posts.js:
- notifyNewPost() ‚úÖ
- updatePostLikes() ‚úÖ
- broadcastToSubscribers() ‚úÖ
```

**Frontend WebSocket Integration:**
```typescript
// components/FeedPageClient.tsx
- useOptimizedRealtimePosts hook ‚úÖ
- handlePostCreated() event handler ‚úÖ
- loadPendingPosts() –¥–ª—è batch updates ‚úÖ

// lib/hooks/useOptimizedRealtimePosts.tsx
- post_created event listener ‚úÖ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏ manual –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ‚úÖ
- Toast notifications ‚úÖ
```

### –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤

**API Endpoint:**
```typescript
// app/api/posts/route.ts (—Å—Ç—Ä–æ–∫–∏ 207-345)
- POST /api/posts - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ ‚úÖ
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç normalized post data ‚úÖ
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—á–µ—Ç—á–∏–∫ –ø–æ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚úÖ
- –ù–ï–¢ WebSocket —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∞–≤—Ç–æ—Ä–∞ ‚ùå
```

**Frontend Modal:**
```typescript
// components/CreatePostModal.tsx (—Å—Ç—Ä–æ–∫–∏ 504-754)
- handleSubmit() —Å–æ–∑–¥–∞–µ—Ç –ø–æ—Å—Ç ‚úÖ
- onPostCreated() callback ‚úÖ
- –í—ã–∑—ã–≤–∞–µ—Ç refresh() –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–µ–Ω—Ç—ã ‚úÖ
- –ü–†–û–ë–õ–ï–ú–ê: Manual refresh –≤–º–µ—Å—Ç–æ real-time ‚ùå
```

## üî¨ CONTEXT7 RESEARCH

### Next.js 15 Real-time Patterns (2025)

**WebSocket vs Server-Sent Events:**
- **WebSocket –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:** Bidirectional, real-time, existing infrastructure
- **SSE –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:** Simpler for one-way updates, auto-reconnect
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é WebSocket –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É

**Performance Considerations:**
- **Connection pooling:** ‚úÖ –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ WebSocket server
- **Memory management:** ‚úÖ Heartbeat –∏ cleanup –≤ websocket-server/src/server.js
- **Event batching:** ‚úÖ –ï—Å—Ç—å batch –ª–æ–≥–∏–∫–∞ –≤ useOptimizedRealtimePosts

### Best Practices –¥–ª—è Real-time Updates

**From Context7 research:**
1. **Graceful degradation:** Real-time –Ω–µ –¥–æ–ª–∂–µ–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π flow
2. **Optimistic updates:** –õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ + server confirmation
3. **Conflict resolution:** Handle race conditions –º–µ–∂–¥—É real-time –∏ manual refresh
4. **User feedback:** Clear visual indication of real-time updates

## üß™ –¢–ï–ö–£–©–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ê–ù–ê–õ–ò–ó

### WebSocket Events Flow

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è (websocket-server/API_INTEGRATION_GUIDE.md):**
```typescript
// –£–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã:
- NEW_POST_FROM_SUBSCRIPTION: –î–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ ‚úÖ
- post_liked/post_unliked: –î–ª—è –ª–∞–π–∫–æ–≤ ‚úÖ  
- notification events: –î–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ‚úÖ

// –û–¢–°–£–¢–°–¢–í–£–ï–¢:
- post_created –¥–ª—è –∞–≤—Ç–æ—Ä–∞ –ø–æ—Å—Ç–∞ ‚ùå
- feed_update –¥–ª—è –∞–≤—Ç–æ—Ä–∞ ‚ùå
```

### Frontend Real-time Hooks

**useOptimizedRealtimePosts:**
```typescript
// lib/hooks/useOptimizedRealtimePosts.tsx (—Å—Ç—Ä–æ–∫–∏ 148-195)
handlePostCreated() —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚úÖ
–ù–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ 'post_created' event ‚úÖ
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ—Å—Ç –≤ –ª–µ–Ω—Ç—É ‚úÖ
```

**FeedPageClient integration:**
```typescript
// components/FeedPageClient.tsx (—Å—Ç—Ä–æ–∫–∏ 47-290)
useOptimizedRealtimePosts –ø–æ–¥–∫–ª—é—á–µ–Ω ‚úÖ
onPostCreated callback –≤ CreatePostModal ‚úÖ
–ù–æ –≤—ã–∑—ã–≤–∞–µ—Ç refresh() –≤–º–µ—Å—Ç–æ real-time ‚ùå
```

## üéÆ PLAYWRIGHT MCP –ò–°–°–õ–ï–î–û–í–ê–ù–ò–ï

### Current User Journey Testing

**–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
1. **Baseline scenario:** –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ refresh behavior
2. **Real-time scenario:** –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
3. **Error scenario:** WebSocket disconnected ‚Üí fallback –∫ refresh
4. **Performance scenario:** –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞

**Browser automation scripts:**
```javascript
// –¢–µ—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ behavior
await page.goto('http://localhost:3000/feed');
await page.click('[data-testid="create-post-button"]');
await page.fill('[data-testid="post-content"]', 'Test post content');
await page.click('[data-testid="submit-post"]');
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω—É–∂–µ–Ω –ª–∏ manual refresh –¥–ª—è –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞
```

## üìä –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ï –ü–û–î–•–û–î–´

### –ü–æ–¥—Ö–æ–¥ 1: WebSocket Event Extension (–†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô)
**Pros:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–µ–Ω —Å –¥—Ä—É–≥–∏–º–∏ real-time features  
- Minimal code changes

**Cons:**
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç WebSocket connectivity
- –¢—Ä–µ–±—É–µ—Ç coordinated changes (backend + frontend)

### –ü–æ–¥—Ö–æ–¥ 2: Optimistic Updates
**Pros:**
- Instant feedback –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç WebSocket
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**Cons:**
- Potential inconsistencies –µ—Å–ª–∏ API response –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü–æ–¥—Ö–æ–¥ 3: Server Actions + Revalidation
**Pros:**  
- Native Next.js approach
- Automatic revalidation

**Cons:**
- –ù–∞—Ä—É—à–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é API architecture
- –¢—Ä–µ–±—É–µ—Ç major refactoring

## üö® –ò–î–ï–ù–¢–ò–§–ò–¶–ò–†–û–í–ê–ù–ù–´–ï –†–ò–°–ö–ò

### üî¥ Critical Risks
**NONE** - –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç critical system paths

### üü° Major Risks  
1. **WebSocket dependency:** –ï—Å–ª–∏ WebSocket –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞–≤—Ç–æ—Ä –Ω–µ —É–≤–∏–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   - **Mitigation:** Fallback –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É refresh() behavior
   
2. **Race conditions:** Real-time event –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ —Ä–∞–Ω—å—à–µ API response
   - **Mitigation:** Deduplication logic –≤ useOptimizedRealtimePosts

### üü¢ Minor Risks
1. **Performance impact:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π WebSocket event
   - **Mitigation:** Event —É–∂–µ exists –¥–ª—è subscribers, minimal overhead
   
2. **Code complexity:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ post creation flow
   - **Mitigation:** Clean separation –º–µ–∂–¥—É API –∏ WebSocket logic

## üéØ –†–ï–®–ï–ù–ò–ï –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥: WebSocket Event Extension

**Core changes needed:**
1. **Backend:** –î–æ–±–∞–≤–∏—Ç—å `post_created` event –¥–ª—è –∞–≤—Ç–æ—Ä–∞ –≤ `/api/posts` route
2. **Frontend:** –û–±–Ω–æ–≤–∏—Ç—å CreatePostModal –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è real-time –≤–º–µ—Å—Ç–æ refresh
3. **Integration:** Ensure proper event routing —á–µ—Ä–µ–∑ WebSocket channels

**Implementation complexity:** üü¢ Low
**Risk level:** üü¢ Minor risks only
**Performance impact:** üü¢ Minimal

## üìù SUCCESS CRITERIA

### Functional Tests
- [ ] –ù–æ–≤—ã–π –ø–æ—Å—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –ª–µ–Ω—Ç–µ –∞–≤—Ç–æ—Ä–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 500ms
- [ ] –ü–æ—Å—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
- [ ] –†–∞–±–æ—Ç–∞–µ—Ç graceful fallback –µ—Å–ª–∏ WebSocket –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ù–µ –Ω–∞—Ä—É—à–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π flow –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### Performance Tests  
- [ ] WebSocket event processing < 100ms
- [ ] No memory leaks –ø—Ä–∏ multiple post creations
- [ ] Feed rendering performance –Ω–µ —É—Ö—É–¥—à–∞–µ—Ç—Å—è

### User Experience Tests
- [ ] Visual feedback –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –∏ smooth
- [ ] –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤ –≤ –ª–µ–Ω—Ç–µ
- [ ] Error states properly handled

## üîó DEPENDENCIES

**Internal:**
- WebSocket server (websocket-server/) ‚úÖ Ready
- useOptimizedRealtimePosts hook ‚úÖ Ready  
- PostNormalizer service ‚úÖ Ready
- CreatePostModal component ‚úÖ Ready

**External:**
- WebSocket library (ws) ‚úÖ Installed
- JWT token system ‚úÖ Working
- Redis pub/sub ‚úÖ Optional –Ω–æ available

## üìã NEXT STEPS

1. **Architecture Context:** Detailed mapping of WebSocket event flow
2. **Solution Plan:** Step-by-step implementation strategy  
3. **Impact Analysis:** Risk assessment –∏ performance implications
4. **Implementation Simulation:** Code examples –∏ edge cases
5. **Risk Mitigation:** Fallback strategies –∏ error handling
6. **Implementation:** Actual code changes
7. **Implementation Report:** Results –∏ lessons learned

**Discovery phase –∑–∞–≤–µ—Ä—à–µ–Ω ‚úÖ** 