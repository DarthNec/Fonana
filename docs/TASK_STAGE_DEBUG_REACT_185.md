## üß™ [Staging Debug –¥–ª—è React Error #185: sourcemap + isolated build]

### –ö–æ–Ω—Ç–µ–∫—Å—Ç
–û—à–∏–±–∫–∞ React #185 ("Invalid hook call") —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –Ω–∞ –ø—Ä–æ–¥–µ. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞, —Ç–∞–∫ –∫–∞–∫ –≤ –ø—Ä–æ–¥-–±–∏–ª–¥–µ –∫–æ–¥ –º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω. –î–ª—è —Ç–æ—á–Ω–æ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è staging-–æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å sourcemaps.

---

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π staging-–±–∏–ª–¥ —Å —á–∏—Ç–∞–µ–º—ã–º–∏ stack trace, –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ production.

---

### –®–∞–≥–∏

#### 1. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É staging
```bash
git checkout -b staging-debug
```

#### 2. –í–∫–ª—é—á–∏—Ç—å sourcemaps –≤ `next.config.js`
–î–æ–±–∞–≤–∏—Ç—å:
```js
productionBrowserSourceMaps: true
```

#### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å staging-—Ñ–ª–∞–≥
–í `.env.production.local` –∏–ª–∏ `.env.staging`:
```env
NEXT_PUBLIC_NODE_ENV=staging
```

#### 4. –°–æ–±—Ä–∞—Ç—å staging-–±–∏–ª–¥
```bash
npm run build
```

---

#### 5. PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `ecosystem.staging.config.js`:

```js
module.exports = {
  apps: [
    {
      name: 'fonana-debug',
      script: 'node_modules/next/dist/bin/next',
      args: 'start -p 3011',
      cwd: '/var/www/fonana',
      env: {
        NODE_ENV: 'production',
        PORT: 3011
      }
    }
  ]
}
```

#### 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å staging –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
ssh -p 43988 root@69.10.59.234

# –í –ø–∞–ø–∫–µ /var/www/fonana
pm2 start ecosystem.staging.config.js
pm2 save
```

#### 7. –ü—Ä–æ–∫–∏–Ω—É—Ç—å –ø–æ—Ä—Ç (–≤—Ä–µ–º–µ–Ω–Ω–æ) –∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞–ø—Ä—è–º—É—é:
```bash
curl http://localhost:3011
# –ò–ª–∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ nginx –Ω–∞ /staging
```

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞
- –û—Ç–∫—Ä—ã—Ç—å `http://<—Å–µ—Ä–≤–µ—Ä>:3011`
- –í–∫–ª—é—á–∏—Ç—å DevTools ‚Üí Console ‚Üí –û—à–∏–±–∫–∞ React #185 —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—É—Ç—å –∏ —Å—Ç—Ä–æ–∫—É
- –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–≥

---

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
–ü–æ—Å–ª–µ —Ñ–∏–∫—Å–∞:
```bash
pm2 stop fonana-debug
pm2 delete fonana-debug
```

---

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

‚úÖ –û—à–∏–±–∫–∞ #185 —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á–∏—Ç–∞–µ–º—ã–π stack trace  
‚úÖ –û—Ç–ª–∞–¥–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤–æ–∑–º–æ–∂–Ω–∞  
‚úÖ –ü—Ä–æ–¥–∞–∫—à–Ω –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç  
‚úÖ –ü–æ—Å–ª–µ —Ñ–∏–∫—Å–∞ staging –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤