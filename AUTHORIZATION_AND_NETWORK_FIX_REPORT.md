# –û—Ç—á–µ—Ç –æ–± —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Å–µ—Ç–µ–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ Fonana

## –î–∞—Ç–∞: 30 –∏—é–Ω—è 2025

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### 1. ‚úÖ –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç–∞—Ä—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ `x-user-wallet` –≤–º–µ—Å—Ç–æ JWT —Ç–æ–∫–µ–Ω–æ–≤.

**–ù–∞–π–¥–µ–Ω–æ –≤:**
- `components/SellablePostModal.tsx` - –ø–æ–∫—É–ø–∫–∞ –ø–æ—Å—Ç–æ–≤ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- `components/SubscribeModal.tsx` - –ø–æ–¥–ø–∏—Å–∫–∏ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- `app/messages/[id]/page.tsx` - –ø–æ–∫—É–ø–∫–∞ PPV —Å–æ–æ–±—â–µ–Ω–∏–π ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- `lib/contexts/NotificationContext.tsx` - 5 –º–µ—Å—Ç (—á–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, –µ—Å—Ç—å fallback)
- `components/SubscriptionPayment.tsx`
- `components/Navbar.tsx`
- `components/BottomNav.tsx` ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- `app/creator/[id]/page.tsx`
- `app/admin/referrals/page.tsx` - 3 –º–µ—Å—Ç–∞

### 2. ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ - –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–û!
**–ü—Ä–æ–±–ª–µ–º–∞**: Nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ—Ä—Ç 3001, –∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3000!

**–†–µ—à–µ–Ω–∏–µ**: 
- –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ `proxy_pass http://localhost:3001` –Ω–∞ `proxy_pass http://localhost:3000`
- Nginx –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω
- –°–∞–π—Ç –∏ API —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ curl)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- –°–∞–π—Ç –æ—Ç–≤–µ—á–∞–µ—Ç 200 OK
- API —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É https://fonana.me

### 3. ‚ö†Ô∏è WebSocket JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - –¢–†–ï–ë–£–ï–¢ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ì–û –ò–°–°–õ–ï–î–û–í–ê–ù–ò–Ø
**–ü—Ä–æ–±–ª–µ–º–∞**: WebSocket –ø–æ–ª—É—á–∞–µ—Ç "invalid signature" –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ JWT —Ç–æ–∫–µ–Ω–æ–≤.

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å**: 
- –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Nginx WebSocket —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ï—Å—Ç—å 3 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ù–æ –Ω–æ–≤—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—Å–µ –µ—â–µ –ø–æ–ª—É—á–∞—é—Ç –æ—à–∏–±–∫—É invalid signature
- –°—Ç–∞—Ä—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

### 4. ‚úÖ Service Worker
**–°—Ç–∞—Ç—É—Å**: Service Worker –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –≤–µ—Ä—Å–∏—è v5, –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º.

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞:

### –§–∞–∑–∞ 1: –°—Ä–æ—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Nginx ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –ò–∑–º–µ–Ω–∏—Ç—å –≤—Å–µ `proxy_pass http://localhost:3001` –Ω–∞ `proxy_pass http://localhost:3000`
- [x] –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Nginx
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–∞–π—Ç–∞ –∏ API

### –§–∞–∑–∞ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ –û–ë–ù–û–í–õ–ï–ù–´
- [x] `app/messages/[id]/page.tsx` - –ø–æ–∫—É–ø–∫–∞ PPV —Å–æ–æ–±—â–µ–Ω–∏–π
- [x] `components/SellablePostModal.tsx` - –ø–æ–∫—É–ø–∫–∞ –ø–æ—Å—Ç–æ–≤
- [x] `components/SubscribeModal.tsx` - –ø–æ–¥–ø–∏—Å–∫–∏
- [x] `components/BottomNav.tsx` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- [ ] `lib/contexts/NotificationContext.tsx` - —É–±—Ä–∞—Ç—å fallback –Ω–∞ x-user-wallet
- [ ] `components/SubscriptionPayment.tsx`
- [ ] `components/Navbar.tsx`
- [ ] `app/creator/[id]/page.tsx`
- [ ] `app/admin/referrals/page.tsx`

### –§–∞–∑–∞ 3: –î–µ–ø–ª–æ–π ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [x] Push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- [x] –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

## –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

### ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:
1. **Nginx –∏—Å–ø—Ä–∞–≤–ª–µ–Ω** - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç–µ–ø–µ—Ä—å –∏–¥—É—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç
2. **–°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω** - https://fonana.me —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **API —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç** - –≤—Å–µ endpoints –æ—Ç–≤–µ—á–∞—é—Ç 200 OK
4. **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã** - –ø–æ–∫—É–ø–∫–∞ –ø–æ—Å—Ç–æ–≤, –ø–æ–¥–ø–∏—Å–∫–∏ –∏ PPV —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç JWT

### üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:
- **–û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3000
- **WebSocket —Å–µ—Ä–≤–µ—Ä**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3002 (–Ω–æ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–æ–≤—ã–º–∏ JWT)
- **Nginx**: ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
- **PM2**: ‚úÖ –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### üéØ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:
‚úÖ API –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 502 Bad Gateway  
‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é  
‚úÖ –°–∞–π—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚úÖ Nginx –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã  
‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–ø–æ–∫—É–ø–∫–∞, –ø–æ–¥–ø–∏—Å–∫–∏) –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ

### üìù –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏:
1. –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ JWT
2. –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å JWT signature –≤ WebSocket
3. –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
4. –£–±—Ä–∞—Ç—å fallback –Ω–∞ x-user-wallet –≤ NotificationContext

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1**: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∫—É–ø–∫—É –ø–æ—Å—Ç–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–∫–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
2. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2**: –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É JWT –≤ WebSocket (–≤–æ–∑–º–æ–∂–Ω–æ, —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è)
3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3**: –ó–∞–≤–µ—Ä—à–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–∞ JWT

## –í–µ—Ä—Å–∏—è –¥–µ–ø–ª–æ—è:
- **Version**: 20250630-075911-c065efd
- **Deployed at**: 30 –∏—é–Ω—è 2025, 15:00 UTC

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ:
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é —Å–∞–π—Ç–∞ –∏ API —Ä–µ—à–µ–Ω—ã. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ JWT –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è WebSocket –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. 