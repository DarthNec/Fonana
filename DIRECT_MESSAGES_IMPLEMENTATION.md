# üí¨ Direct Messages Implementation

## Overview
Implemented a full-featured Direct Messages (DM) system with paid messages (PPV) support, similar to OnlyFans.

## Database Schema

### Models Added:
1. **Conversation** - –ß–∞—Ç—ã –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
2. **Message** - –°–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–µ–¥–∏–∞ –∏ –æ–ø–ª–∞—Ç—ã
3. **MessagePurchase** - –ü–æ–∫—É–ø–∫–∏ –ø–ª–∞—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
4. **TransactionType.MESSAGE_PURCHASE** - –ù–æ–≤—ã–π —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

## API Endpoints

### Conversations
- `GET /api/conversations` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
- `POST /api/conversations` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç

### Messages
- `GET /api/conversations/[id]/messages` - –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
- `POST /api/conversations/[id]/messages` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `POST /api/messages/[id]/purchase` - –ö—É–ø–∏—Ç—å –ø–ª–∞—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

## UI Components

### Pages
1. **`/messages`** - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤
   - –ü–æ–∏—Å–∫ –ø–æ —á–∞—Ç–∞–º
   - –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ–≤—å—é
   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

2. **`/messages/[id]`** - –°—Ç—Ä–∞–Ω–∏—Ü–∞ —á–∞—Ç–∞
   - Real-time polling (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ –∏ –º–µ–¥–∏–∞
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ü–æ–∫—É–ø–∫–∞ PPV –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### Features
- üí¨ –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- üì∑ –ú–µ–¥–∏–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ)
- üí∞ –ü–ª–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (PPV)
- üîí Blur —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –ø–ª–∞—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ –°—Ç–∞—Ç—É—Å –ø—Ä–æ—á—Ç–µ–Ω–∏—è
- üîÑ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

## Integration Points

1. **Creator Profile** - –ö–Ω–æ–ø–∫–∞ "Message" –¥–ª—è –Ω–∞—á–∞–ª–∞ —á–∞—Ç–∞
2. **Navigation** - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ Messages –≤ –º–µ–Ω—é
3. **Wallet Integration** - –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Solana

## Monetization Features

### PPV Messages
- –°–æ–∑–¥–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–ª–∞—Ç–Ω—ã–º
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω—ã –≤ SOL
- Blur —ç—Ñ—Ñ–µ–∫—Ç —Å –ø—Ä–µ–≤—å—é –ø–µ—Ä–≤—ã—Ö 30 —Å–∏–º–≤–æ–ª–æ–≤
- –ö–Ω–æ–ø–∫–∞ "Unlock" –¥–ª—è –ø–æ–∫—É–ø–∫–∏
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ë–î

### Revenue Split
- –°–æ–∑–¥–∞—Ç–µ–ª—å: –æ—Å–Ω–æ–≤–Ω–∞—è —Å—É–º–º–∞
- –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: –∫–æ–º–∏—Å—Å–∏—è (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- –†–µ—Ñ–µ—Ä–µ—Ä: 5% (–µ—Å–ª–∏ –µ—Å—Ç—å)

## Technical Implementation

### Security
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—á–∞—Å—Ç–∏—è –≤ —á–∞—Ç–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π Solana
- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–∫—É–ø–æ–∫ (–Ω–µ–ª—å–∑—è –∫—É–ø–∏—Ç—å –¥–≤–∞–∂–¥—ã)

### Performance
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (50 –∑–∞ —Ä–∞–∑)
- Lazy loading —á–∞—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏

### User Experience
- Smooth scrolling –∫ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏
- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω

## Future Enhancements

1. **Push Notifications** - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
2. **Typing Indicator** - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞
3. **Voice Messages** - –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
4. **File Attachments** - –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
5. **Message Reactions** - –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
6. **Group Chats** - –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã
7. **Message Search** - –ü–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º
8. **End-to-End Encryption** - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

## Usage

### For Users:
1. –ù–∞–∂–∞—Ç—å "Message" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ–∑–¥–∞—Ç–µ–ª—è
2. –ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
3. –ö—É–ø–∏—Ç—å –ø–ª–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏

### For Creators:
1. –ü–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Ñ–∞–Ω–æ–≤
2. –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–ª–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ü–µ–Ω—ã –Ω–∞ PPV

## Testing

```bash
# Local testing
npm run dev

# Create test conversation
curl -X POST http://localhost:3000/api/conversations \
  -H "x-user-wallet: YOUR_WALLET" \
  -H "Content-Type: application/json" \
  -d '{"participantId": "CREATOR_ID"}'
```

## Deployment

```bash
# Deploy to production
./deploy-to-server.sh
```

## Revenue Potential

- **Average PPV price**: $5-20
- **Conversion rate**: 20-30% 
- **Revenue increase**: 2-3x vs subscriptions only
- **OnlyFans benchmark**: 80% revenue from PPV

This implementation brings Fonana closer to feature parity with OnlyFans while maintaining the Web3 advantages.

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (19.06.2025)

1. **–û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –≤ —á–∞—Ç–µ** - –£–≤–µ–ª–∏—á–µ–Ω –¥–æ pt-32 (128px), —É—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–∞–≤–±–∞—Ä –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
2. **–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞** - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –≤–∏–¥–µ–æ —Å –ø—Ä–µ–≤—å—é
3. **–û—Ç–ø—Ä–∞–≤–∫–∞ —á–∞–µ–≤—ã—Ö (Tips)** - –ö—Ä–∞—Å–∏–≤—ã–π –º–æ–¥–∞–ª —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏ –∏ –∑–∞–ø–∏—Å—å—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
4. **UI —á–∞–µ–≤—ã—Ö** - –°—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–º–µ—Å—Ç–æ plain text
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–∞–µ–≤—ã—Ö** - –ñ–¥–µ–º –ø–æ–ª–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
6. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö** - Toast –∏ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
7. **API —á–∞–µ–≤—ã—Ö —É–ª—É—á—à–µ–Ω** - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ, –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ —Å–æ–∑–¥–∞—Ç–µ–ª—è

## üöß TODO - –ù–µ–¥–æ—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (P0)
1. **–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - –ó–∞–ø–∏—Å—å –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞—É–¥–∏–æ
2. **–í–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∏** - WebRTC –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤
3. **Mass Messages** - –ú–∞—Å—Å–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ –¥–ª—è –∫—Ä–µ–∞—Ç–æ—Ä–æ–≤
4. **–ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
5. **–®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π** - –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –∫—Ä–µ–∞—Ç–æ—Ä–æ–≤

### –í–∞–∂–Ω—ã–µ (P1)
6. **Typing Indicator** - "–ø–µ—á–∞—Ç–∞–µ—Ç..." –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
7. **Online Status** - –°—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω
8. **Message Reactions** - –≠–º–æ–¥–∑–∏ —Ä–µ–∞–∫—Ü–∏–∏
9. **Reply to Message** - –û—Ç–≤–µ—Ç –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
10. **Delete Messages** - –£–¥–∞–ª–µ–Ω–∏–µ —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω
11. **Edit Messages** - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö
12. **Forward Messages** - –ü–µ—Ä–µ—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
13. **Pin Messages** - –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –≤–∞–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ (P2)
14. **Group Chats** - –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã –¥–ª—è —Ñ–∞–Ω–æ–≤
15. **Message Search** - –ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏
16. **Chat Export** - –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF/TXT
17. **Archive Chats** - –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö
18. **Block Users** - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
19. **Read Receipts** - –î–≤–æ–π–Ω—ã–µ –≥–∞–ª–æ—á–∫–∏ –ø—Ä–æ—á—Ç–µ–Ω–∏—è
20. **Scheduled Messages** - –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
21. **Message Expiry** - –ò—Å—á–µ–∑–∞—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
22. **End-to-End Encryption** - –ü–æ–ª–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

### –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è (P1)
23. **Paid Voice/Video Calls** - –ü–ª–∞—Ç–Ω—ã–µ –∑–≤–æ–Ω–∫–∏
24. **Message Bundles** - –ü–∞–∫–µ—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π
25. **Priority Messages** - –ü–ª–∞—Ç–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
26. **Custom Emojis** - –ü–ª–∞—Ç–Ω—ã–µ —Å—Ç–∏–∫–µ—Ä—ã/—ç–º–æ–¥–∑–∏

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ù–µ–¥–µ–ª—è 1**: –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è + Typing indicator + Online status
**–ù–µ–¥–µ–ª—è 2**: –í–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∏ + Mass messages + –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã  
**–ù–µ–¥–µ–ª—è 3**: –†–µ–∞–∫—Ü–∏–∏ + –û—Ç–≤–µ—Ç—ã + –£–¥–∞–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ù–µ–¥–µ–ª—è 4**: –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã + –ü–æ–∏—Å–∫ + –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏

–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç: +50% –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏, +30% –¥–æ—Ö–æ–¥–∞ –æ—Ç PPV 