# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket –∏ Real-time —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

## –î–∞—Ç–∞: 29 –¥–µ–∫–∞–±—Ä—è 2024

## –°—Ç–∞—Ç—É—Å: ‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û

### –†–µ–∑—é–º–µ

WebSocket –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Fonana –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –≠—Ç–∞–ø 1 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚úÖ

#### –¢–µ—Å—Ç 1: –í–∞–ª–∏–¥–Ω—ã–π JWT —Ç–æ–∫–µ–Ω ‚úÖ PASSED
- –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- JWT —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω
- –ü–æ–ª—É—á–µ–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç

#### –¢–µ—Å—Ç 2: –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JWT —Ç–æ–∫–µ–Ω ‚úÖ PASSED
- –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ —Å –∫–æ–¥–æ–º 1008 (Unauthorized)
- –û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –î–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

#### –¢–µ—Å—Ç 3: –ë–µ–∑ JWT —Ç–æ–∫–µ–Ω–∞ ‚úÖ PASSED
- –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ —Å –∫–æ–¥–æ–º 1008 (Unauthorized)
- –ê–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∞

### –≠—Ç–∞–ø 2 ‚Äî Real-time —Å–æ–±—ã—Ç–∏—è ‚úÖ

#### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
1. **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π**
   - Connected —Å–æ–±—ã—Ç–∏–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª—ã —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. **–ö–∞–Ω–∞–ª—ã –ø–æ–¥–ø–∏—Å–∫–∏:**
   - `notifications` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - `user:{userId}` - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
   - `creator:{creatorId}` - —Å–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞—Ç–µ–ª—è
   - `post:{postId}` - —Å–æ–±—ã—Ç–∏—è –ø–æ—Å—Ç–∞

3. **–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π:**
   - `subscription-updated` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
   - `post-purchased` - –ø–æ–∫—É–ø–∫–∞ –ø–æ—Å—Ç–∞
   - `notification` - –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   - `post_liked` / `post_unliked` - –ª–∞–π–∫–∏
   - `comment_added` - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

### –≠—Ç–∞–ø 3 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚úÖ

#### JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
- ‚úÖ –¢–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è
- ‚úÖ –¢–æ–∫–µ–Ω—ã —Å –∏—Å—Ç–µ–∫—à–∏–º —Å—Ä–æ–∫–æ–º –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è
- ‚úÖ –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ê–Ω–æ–Ω–∏–º–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω—ã

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è
- IP –∞–¥—Ä–µ—Å–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞

### –≠—Ç–∞–ø 4 ‚Äî –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚úÖ

#### WebSocket —Å–µ—Ä–≤–µ—Ä:
- **–ü—Ä–æ—Ü–µ—Å—Å**: fonana-ws
- **–ü–æ—Ä—Ç**: 3002
- **Uptime**: –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (0 —Ä–µ—Å—Ç–∞—Ä—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å)
- **–ü–∞–º—è—Ç—å**: ~74MB (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)
- **CPU**: 0% –≤ —Ä–µ–∂–∏–º–µ –æ–∂–∏–¥–∞–Ω–∏—è

#### Nginx proxy:
- **Endpoint**: wss://fonana.me/ws
- **–ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ**: localhost:3002
- **SSL**: –í–∫–ª—é—á–µ–Ω

#### PM2 —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—Ç–∞—Ä—Ç –ø—Ä–∏ —Å–±–æ—è—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª—ã
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### JWT —Ç–æ–∫–µ–Ω—ã:
```javascript
// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–æ–∫–µ–Ω–∞
{
  userId: 'user_id',
  wallet: 'wallet_address',
  sub: 'user_id',
  iat: 1234567890,
  exp: 1234567890
}
```

### WebSocket —Å–æ–æ–±—â–µ–Ω–∏—è:
```javascript
// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª
{
  type: 'subscribe',
  channel: 'notifications'
}

// –°–æ–±—ã—Ç–∏–µ
{
  type: 'notification',
  data: { ... }
}
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket:
```javascript
const token = localStorage.getItem('fonana_jwt_token');
const ws = new WebSocket('wss://fonana.me/ws', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π:
```javascript
ws.on('message', (data) => {
  const event = JSON.parse(data);
  
  switch(event.type) {
    case 'post-purchased':
      // –û–±–Ω–æ–≤–∏—Ç—å UI - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç
      break;
    case 'subscription-updated':
      // –û–±–Ω–æ–≤–∏—Ç—å UI - –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π —Ç–∏—Ä
      break;
  }
});
```

## –ò—Ç–æ–≥–∏

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏:
1. WebSocket —Å–µ—Ä–≤–µ—Ä —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
3. Real-time —Å–æ–±—ã—Ç–∏—è –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ
5. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ –Ω–∞–≥—Ä—É–∑–∫–∞–º

### üöÄ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- –ü–æ–∫—É–ø–∫–∞ –ø–æ—Å—Ç–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- –ê–ø–≥—Ä–µ–π–¥ –ø–æ–¥–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ real-time
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∞ JWT —Ç–æ–∫–µ–Ω–∞–º–∏

## –°—Ç–∞—Ç—É—Å: PRODUCTION READY ‚úÖ

WebSocket –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Fonana –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. 