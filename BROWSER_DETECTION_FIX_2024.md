# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ –∫–æ—à–µ–ª—å–∫–æ–≤ (–î–µ–∫–∞–±—Ä—å 2024)

## –ü—Ä–æ–±–ª–µ–º–∞
–í –æ–±—ã—á–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö (Firefox, Chrome) –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ "üí° –î–ª—è –ª—É—á—à–µ–≥–æ –æ–ø—ã—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ", –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ –∫–æ—à–µ–ª—å–∫–æ–≤.

## –ü—Ä–∏—á–∏–Ω–∞
–§—É–Ω–∫—Ü–∏—è `detectWalletEnvironment()` —Å–æ–¥–µ—Ä–∂–∞–ª–∞ –ø—Ä–æ–±–ª–µ–º–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:
```typescript
// Phantom desktop popup (–∏–º–µ–µ—Ç –æ—Å–æ–±—ã–π user agent)
(userAgent.includes('phantom') && !isMobile && window.opener !== null)
```

–≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ –≤ –æ–±—ã—á–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Phantom –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ª–æ–≤–æ "phantom" –≤ user agent –¥–∞–∂–µ –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
2. `window.opener` –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ null –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö, –Ω–µ —Ç–æ–ª—å–∫–æ –≤ popup –æ–∫–Ω–∞—Ö

## –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `detectWalletEnvironment()` –≤ `lib/auth/solana.ts`
- –£–¥–∞–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è "Phantom desktop popup"
- –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è Phantom mobile app - —Ç–µ–ø–µ—Ä—å –∏—â–µ–º –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–∫–∞–∑–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ `HybridWalletConnect.tsx`
- –£–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `!env.isMobile` —Ç–∞–∫ –∫–∞–∫ –ø–æ–¥—Å–∫–∞–∑–∫–∞ –Ω—É–∂–Ω–∞ –∏–º–µ–Ω–Ω–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

## –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
```typescript
const isInWalletBrowser = 
  // Phantom mobile app - –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
  (userAgent.includes('phantom-app') || (userAgent.includes('phantom') && isMobile && userAgent.includes('mobile'))) ||
  // Solflare mobile app
  (userAgent.includes('solflare') && isMobile) ||
  // Backpack mobile app
  (userAgent.includes('backpack') && isMobile) ||
  // Trust Wallet
  userAgent.includes('trustwallet') ||
  // MetaMask mobile
  (isMobile && !!(window as any).ethereum && userAgent.includes('metamask'))
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞:
https://fonana.me/test/browser-detection

–ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å:
- –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
- User Agent
- –í—Å–µ window properties
- –ê–Ω–∞–ª–∏–∑ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

## –ö–∞–∫ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

### ‚úÖ –û–±—ã—á–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã (–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É):
- Chrome/Firefox/Safari –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º Phantom
- Chrome/Firefox/Safari –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- –õ—é–±–æ–π –±—Ä–∞—É–∑–µ—Ä, –æ—Ç–∫—Ä—ã—Ç—ã–π –æ–±—ã—á–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º

### ‚ùå –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã –∫–æ—à–µ–ª—å–∫–æ–≤ (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É):
- Phantom mobile app (in-app browser)
- Solflare mobile app (in-app browser)
- Backpack mobile app (in-app browser)
- Trust Wallet browser
- MetaMask mobile browser

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, –º–æ–∂–Ω–æ:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö API –∫–æ—à–µ–ª—å–∫–æ–≤
2. –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö JavaScript –æ–±—ä–µ–∫—Ç–æ–≤, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –≤ embedded –±—Ä–∞—É–∑–µ—Ä–∞—Ö
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å feature detection –≤–º–µ—Å—Ç–æ user agent sniffing 