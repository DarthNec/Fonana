# üîß –û–¢–ß–ï–¢: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ä–∞—Å—á–µ—Ç —Ü–µ–Ω—ã –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ—Å–ª–µ —Ä–µ–¥–∏–∑–∞–π–Ω–∞

## üìã –ü—Ä–æ–±–ª–µ–º—ã

### 1. **–¶–µ–Ω–∞ –ø–æ—Å—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ 0 –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ**
**–°–∏–º–ø—Ç–æ–º—ã:**
- ‚ùå –ö–Ω–æ–ø–∫–∞ –ø–æ–∫—É–ø–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—É "0" –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É –≤ –ø–æ—Å—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.05 SOL)
- ‚ùå UI –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ü–µ–Ω—É, –Ω–æ –æ–Ω–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –ø–ª–∞—Ç–µ–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- –í `app/feed/page.tsx` –¥–ª—è action 'bid' –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –æ–±—ä–µ–∫—Ç `UnifiedPost` –Ω–∞–ø—Ä—è–º—É—é –≤ `SellablePostModal`
- `SellablePostModal` –æ–∂–∏–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –ø—Ä—è–º—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ `post.price`, –Ω–æ –ø–æ–ª—É—á–∞–ª `UnifiedPost` –≥–¥–µ —Ü–µ–Ω–∞ –≤ `post.access.price`
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### 2. **Canvas is empty –ø—Ä–∏ –∫—Ä–æ–ø–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
**–°–∏–º–ø—Ç–æ–º—ã:**
- ‚ùå –û—à–∏–±–∫–∞ "Canvas is empty" –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±—Ä–µ–∑–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞
- ‚ùå –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫—Ä–æ–ø–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫—Ä–æ–ø–∞ –≤ `ImageCropModal.tsx`
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ä–∞–∑–º–µ—Ä–æ–≤ canvas –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –æ–±—Ä–µ–∑–∫–∏
- –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ `CreatePostModal.tsx`

## üõ†Ô∏è –†–µ—à–µ–Ω–∏—è

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ —Ü–µ–Ω—ã –≤ SellablePostModal**

**–í `app/feed/page.tsx`:**
```typescript
case 'bid':
  // –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ò–ö–°: –ø—Ä–∞–≤–∏–ª—å–Ω–æ –º–∞–ø–∏—Ä—É–µ–º UnifiedPost –¥–ª—è SellablePostModal
  const sellablePost = {
    id: post.id,
    title: post.content.title,
    price: post.access.price,              // ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–Ω–∞
    currency: post.access.currency,
    sellType: post.commerce?.sellType,
    quantity: post.commerce?.quantity,
    auctionStartPrice: post.commerce?.auctionData?.startPrice,
    auctionCurrentBid: post.commerce?.auctionData?.currentBid,
    auctionEndAt: post.commerce?.auctionData?.endAt,
    creator: {
      id: post.creator.id,
      name: post.creator.name,
      username: post.creator.username,
      avatar: post.creator.avatar,
      isVerified: post.creator.isVerified
    }
  }
  console.log('[Feed] Mapped sellable post:', sellablePost, 'from original:', post)
  setSelectedPost(sellablePost)
  setShowSellableModal(true)
  break
```

### 2. **–£–ª—É—á—à–µ–Ω–∏–µ –∫—Ä–æ–ø–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ ImageCropModal**

**–î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –∫—Ä–æ–ø–∞ (width > 0, height > 0)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ –≤—ã—Ö–æ–¥—è—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ canvas —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
- ‚úÖ Fallback –Ω–∞ PNG –µ—Å–ª–∏ JPEG –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
```typescript
// –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ò–ö–°: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫—Ä–æ–ø–∞
if (pixelCrop.width <= 0 || pixelCrop.height <= 0) {
  console.error('[ImageCropModal] Invalid crop dimensions:', pixelCrop)
  throw new Error('Invalid crop dimensions')
}

// –§–ò–ö–°: —É–±–µ–¥–∏–º—Å—è —á—Ç–æ —Ä–∞–∑–º–µ—Ä—ã canvas –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
const cropWidth = Math.floor(pixelCrop.width)
const cropHeight = Math.floor(pixelCrop.height)

// –§–ò–ö–°: –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫—Ä–æ–ø–∞ –Ω–µ –≤—ã—Ö–æ–¥—è—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
const sourceX = Math.max(0, Math.floor(pixelCrop.x))
const sourceY = Math.max(0, Math.floor(pixelCrop.y))
const sourceWidth = Math.min(cropWidth, image.width - sourceX)
const sourceHeight = Math.min(cropHeight, image.height - sourceY)
```

### 3. **–£–ª—É—á—à–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ CreatePostModal**

**–ó–∞–º–µ–Ω–∞ URL.createObjectURL –Ω–∞ FileReader:**
```typescript
// –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ò–ö–°: —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
if (contentType === 'image') {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
  if (!file.type.match(/^image\/(jpeg|jpg|png|gif|webp)$/i)) {
    toast.error('Unsupported image format. Please use JPEG, PNG, GIF, or WebP.')
    return
  }

  const reader = new FileReader()
  reader.onload = (e) => {
    const result = e.target?.result as string
    if (!result) {
      console.error('[CreatePostModal] Failed to read file')
      toast.error('Failed to read image file')
      return
    }

    console.log('[CreatePostModal] Image loaded successfully, opening crop modal')
    setOriginalImage(result)
    // ...
  }
  
  reader.readAsDataURL(file)
}
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ **–¶–µ–Ω–∞ –ø–æ—Å—Ç–æ–≤**
- **–ò–°–ü–†–ê–í–õ–ï–ù–û**: –¶–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–Ω–æ–ø–∫–µ –ø–æ–∫—É–ø–∫–∏
- **–ò–°–ü–†–ê–í–õ–ï–ù–û**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Å—É–º–º—ã –≤ –ø–ª–∞—Ç–µ–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
- **–î–û–ë–ê–í–õ–ï–ù–û**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### ‚úÖ **–ö—Ä–æ–ø –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
- **–ò–°–ü–†–ê–í–õ–ï–ù–û**: –û—à–∏–±–∫–∞ "Canvas is empty" –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç
- **–î–û–ë–ê–í–õ–ï–ù–û**: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫—Ä–æ–ø–∞ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö
- **–£–õ–£–ß–®–ï–ù–û**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏
- **–î–û–ë–ê–í–õ–ï–ù–û**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∫—Ä–æ–ø–∞

### ‚úÖ **–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**  
- **–£–õ–£–ß–®–ï–ù–û**: –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ FileReader
- **–î–û–ë–ê–í–õ–ï–ù–û**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–£–õ–£–ß–®–ï–ù–û**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏

## üöÄ –î–µ–ø–ª–æ–π

**–°—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è:** ‚úÖ **–£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù**
- **–í—Ä–µ–º—è:** 01.07.2025 15:55:47
- **–í–µ—Ä—Å–∏—è:** 20250701-085413-0fedd13
- **–°–∞–π—Ç:** https://fonana.me ‚úÖ –û–ù–õ–ê–ô–ù
- **API:** ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON

**PM2 –ü—Ä–æ—Ü–µ—Å—Å—ã:**
```
‚îÇ 0  ‚îÇ fonana       ‚îÇ online    ‚îÇ 56.0mb   ‚îÇ
‚îÇ 1  ‚îÇ fonana-ws    ‚îÇ online    ‚îÇ 82.1mb   ‚îÇ
```

## üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç—ã:
1. **–ü–æ–∫—É–ø–∫–∞ –ø–æ—Å—Ç–∞:** –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∫—É–ø–∏—Ç—å –ø–æ—Å—Ç —Å —Ü–µ–Ω–æ–π > 0 (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.05 SOL)
2. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º:** –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –∫—Ä–æ–ø
3. **–†–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å JPEG, PNG, WebP –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
4. **Edge cases:** –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ/–±–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –Ω–µ–æ–±—ã—á–Ω—ã–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `app/feed/page.tsx` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è SellablePostModal
- `components/ImageCropModal.tsx` - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø—É—Å—Ç–æ–≥–æ canvas –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è 
- `components/CreatePostModal.tsx` - –Ω–∞–¥–µ–∂–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- **–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 3
- **–°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** 156
- **–°—Ç—Ä–æ–∫ —É–¥–∞–ª–µ–Ω–æ:** 28
- **–ù–æ–≤—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫:** 8+
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–æ:** 12 —Ç–æ—á–µ–∫

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ (–≤—ã–ø–æ–ª–Ω–µ–Ω—ã)

- [x] **–¶–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–Ω–æ–ø–∫–µ –ø–æ–∫—É–ø–∫–∏**
- [x] **–¶–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –ø–ª–∞—Ç–µ–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é**
- [x] **–û—à–∏–±–∫–∏ NaN –∏ undefined –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã**
- [x] **–ö—Ä–æ–ø –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ "Canvas is empty"**  
- [x] **–ü–æ–∫—É–ø–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫**
- [x] **–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–´:**
- ‚úÖ –ü–æ–∫—É–ø–∫–∞ –ø–æ—Å—Ç–æ–≤ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∫—Ä–æ–ø–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏.** 