# Исправление падения модалки редактирования из feed

## Дата: 26.12.2024

### Проблема:
Модалка редактирования падала при попытке загрузить новую картинку, и посты становились заблокированными для автора.

### Корневая причина:
1. **Потеря данных при передаче**: Feed форматировал посты и передавал в PostCard только `image`, который вычислялся как `mediaUrl || thumbnail`
2. **API скрывал mediaUrl**: Если по какой-то причине shouldHideContent становился true, API возвращал `mediaUrl: null`
3. **EditPostModal не получала оригинальные данные**: Модалка получала только обработанное значение `image`, не зная реальных `mediaUrl` и `thumbnail`
4. **Циклическая проблема**: После обновления API мог неправильно определить доступ и вернуть null, что приводило к показу старого thumbnail

### Решение:

1. **components/PostCard.tsx**:
   - Добавлены props `mediaUrl` и `thumbnail` для передачи оригинальных значений
   - EditPostModal теперь получает оба оригинальных поля

2. **app/feed/page.tsx**:
   - Передаёт оригинальные `mediaUrl` и `thumbnail` в PostCard
   - Сохраняет вычисленное `image` для отображения

3. **app/api/posts/route.ts**:
   - Всегда возвращает оригинальные `mediaUrl` и `thumbnail`
   - Не скрывает контент для автора поста (`!isCreatorPost`)
   - Добавлено логирование для отладки

4. **app/test/post-management/page.tsx**:
   - Обновлена для явной передачи новых полей

### Результат:
- EditPostModal всегда получает правильные оригинальные пути к изображениям
- Автор всегда видит свой контент
- Модалка больше не падает при загрузке новых изображений
- Нет циклического показа старых изображений

### Статус: ✅ Исправлено 