#!/bin/bash

echo "üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è fonana —Å —Å–µ—Ä–≤–µ—Ä–∞"
echo "==========================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω –æ—Ç root
if [ "$EUID" -ne 0 ]; then 
    echo "‚ùå –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –æ—Ç root"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
if ! id "fonana" &>/dev/null; then
    echo "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å fonana –Ω–µ –Ω–∞–π–¥–µ–Ω (—É–∂–µ —É–¥–∞–ª–µ–Ω)"
    exit 0
fi

echo "üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ fonana:"
id fonana
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è..."
PROCESSES=$(ps -u fonana -o pid= 2>/dev/null | wc -l)
if [ "$PROCESSES" -gt 0 ]; then
    echo "‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω—ã –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è fonana:"
    ps -u fonana -o pid,cmd
    echo ""
    echo "–ó–∞–≤–µ—Ä—à–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã..."
    pkill -u fonana
    sleep 2
    pkill -9 -u fonana 2>/dev/null
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
if [ -d "/home/fonana" ]; then
    echo "üìÅ –î–æ–º–∞—à–Ω—è—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: /home/fonana"
    echo "   –†–∞–∑–º–µ—Ä: $(du -sh /home/fonana 2>/dev/null | cut -f1)"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–∏—Å–∏ –≤ sudoers
echo ""
echo "üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ sudo –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π..."
if grep -q "fonana" /etc/sudoers 2>/dev/null; then
    echo "‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω—ã –∑–∞–ø–∏—Å–∏ –≤ /etc/sudoers"
fi

if [ -f "/etc/sudoers.d/fonana" ]; then
    echo "‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω —Ñ–∞–π–ª /etc/sudoers.d/fonana"
fi

# –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
echo ""
echo "üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è fonana..."

# –£–¥–∞–ª—è–µ–º –∏–∑ sudoers –µ—Å–ª–∏ –µ—Å—Ç—å
if [ -f "/etc/sudoers.d/fonana" ]; then
    rm -f /etc/sudoers.d/fonana
    echo "‚úÖ –£–¥–∞–ª–µ–Ω —Ñ–∞–π–ª /etc/sudoers.d/fonana"
fi

# –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–º–µ—Å—Ç–µ —Å –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π
userdel -r fonana 2>/dev/null
if [ $? -eq 0 ]; then
    echo "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å fonana —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω"
else
    echo "‚ö†Ô∏è  –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ—à–∏–±–∫–æ–π, –ø—Ä–æ–±—É–µ–º —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ..."
    userdel -f -r fonana 2>/dev/null
    if [ $? -eq 0 ]; then
        echo "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å fonana —É–¥–∞–ª–µ–Ω (—Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ)"
    else
        echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    fi
fi

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
echo ""
echo "üßπ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞..."

# –£–¥–∞–ª—è–µ–º –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–∞—Å—å
if [ -d "/home/fonana" ]; then
    rm -rf /home/fonana
    echo "‚úÖ –£–¥–∞–ª–µ–Ω–∞ –¥–æ–º–∞—à–Ω—è—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è /home/fonana"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —á–∏—Å—Ç–∏–º –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª–∞—Ö
for file in /etc/passwd /etc/shadow /etc/group /etc/gshadow; do
    if grep -q "fonana" "$file" 2>/dev/null; then
        echo "‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω—ã –∑–∞–ø–∏—Å–∏ –≤ $file, –æ—á–∏—â–∞–µ–º..."
        sed -i '/fonana/d' "$file"
    fi
done

# –ü—Ä–æ–≤–µ—Ä—è–µ–º SSH –∫–ª—é—á–∏
if [ -d "/home/fonana/.ssh" ]; then
    rm -rf /home/fonana/.ssh
    echo "‚úÖ –£–¥–∞–ª–µ–Ω—ã SSH –∫–ª—é—á–∏"
fi

# –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
echo ""
echo "üìä –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:"
if id "fonana" &>/dev/null; then
    echo "‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å fonana –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!"
else
    echo "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å fonana –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω"
fi

if [ -d "/home/fonana" ]; then
    echo "‚ùå –î–æ–º–∞—à–Ω—è—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!"
else
    echo "‚úÖ –î–æ–º–∞—à–Ω—è—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞"
fi

echo ""
echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" 