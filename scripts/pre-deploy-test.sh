#!/bin/bash

echo "üß™ –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
echo "1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–±–æ—Ä–∫—É –ø—Ä–æ–µ–∫—Ç–∞..."
npm run build
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏! –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º."
    exit 1
fi
echo "‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ sharp —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ
echo "2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É sharp..."
if npm list sharp | grep -q "sharp@"; then
    echo "‚úÖ Sharp —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
else
    echo "‚ùå Sharp –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å TypeScript
echo "3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º TypeScript..."
npx tsc --noEmit
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∏ TypeScript! –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º."
    exit 1
fi
echo "‚úÖ TypeScript –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
echo "4Ô∏è‚É£ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
echo "–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:"
git diff --name-only
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ 5: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã
echo "5Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
CRITICAL_FILES=(
    "app/api/posts/route.ts"
    "app/api/posts/upload/route.ts"
    "components/PostCard.tsx"
)

for file in "${CRITICAL_FILES[@]}"; do
    if git diff --name-only | grep -q "$file"; then
        echo "‚ö†Ô∏è  –ò–∑–º–µ–Ω–µ–Ω –∫—Ä–∏—Ç–∏—á–Ω—ã–π —Ñ–∞–π–ª: $file"
        echo "   –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏!"
    fi
done

echo ""
echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã!"
echo ""
echo "üìã –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:"
echo "   [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π"
echo "   [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–æ—Å—Ç–æ–≤"
echo "   [ ] –£–±–µ–¥–∏–ª–∏—Å—å —á—Ç–æ OptimizedImage –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ preview"
echo "   [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"
echo ""
echo "–ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ, –∑–∞–ø—É—Å—Ç–∏—Ç–µ: ./scripts/deploy-image-optimization.sh" 