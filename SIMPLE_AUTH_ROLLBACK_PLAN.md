# План отката к простой авторизации (без JWT)

## Проблема
JWT система оказалась слишком сложной и ненадежной:
- Авторизация слетает при обновлении страницы
- Белый экран на мобильных устройствах
- Проблемы с cookies и session storage
- Слишком много точек отказа

## Решение: вернуться к простой системе

### 1. Что сделано
- ✅ Создан `SimpleWalletConnect` - простая кнопка без JWT
- ✅ Обновлен `Navbar` для использования простой версии
- ✅ Восстановлен оригинальный `WalletProvider`
- ✅ Создана тестовая страница `/test/simple-auth`

### 2. Что нужно сделать

#### Удалить JWT компоненты и зависимости:
- [ ] Удалить `HybridWalletConnect.tsx`
- [ ] Удалить `ConnectWalletOnDemand.tsx`
- [ ] Удалить `MobileAuthHelper.tsx`
- [ ] Удалить `lib/auth/jwt.ts`
- [ ] Удалить `app/api/auth/wallet/*`
- [ ] Удалить `lib/hooks/useAuth.ts`

#### Обновить компоненты для работы без JWT:
- [ ] Все компоненты должны использовать `useWallet` напрямую
- [ ] Проверка авторизации через `connected` из wallet-adapter
- [ ] Получение пользователя через `publicKey` и API

#### Упростить логику:
- [ ] Авторизация = кошелек подключен
- [ ] Нет сессий, нет токенов, нет cookies
- [ ] Только wallet-adapter state

### 3. Преимущества простого подхода

1. **Надежность**: Авторизация привязана к состоянию кошелька
2. **Простота**: Нет JWT, cookies, session storage
3. **Совместимость**: Работает везде где работает wallet-adapter
4. **Меньше кода**: Меньше точек отказа

### 4. Как будет работать определение браузера

```typescript
// В SimpleWalletConnect:
- Определяем встроенный браузер через detectWalletEnvironment()
- Показываем подсказку только в настоящих embedded браузерах
- Кнопка "Скопировать ссылку" вместо сложной синхронизации
```

### 5. План действий

1. **Немедленно**: Задеплоить SimpleWalletConnect
2. **Потом**: Постепенно удалить JWT компоненты
3. **Финал**: Полностью перейти на простую систему

## Команды для деплоя

```bash
# Коммит изменений
git add -A && git commit -m "Откат к простой авторизации без JWT"

# Деплой
./deploy-to-production.sh

# Или если скрипт не работает
ssh -p 43988 root@69.10.59.234 "cd /var/www/fonana && git pull && npm run build && pm2 restart fonana"
```

## Итог
Вместо сложной JWT системы с кучей проблем, возвращаемся к простому и надежному решению на основе wallet-adapter. Изначальная задача была просто показать подсказку во встроенных браузерах - для этого не нужен JWT. 