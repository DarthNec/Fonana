# Реферальная система Fonana

## Обзор

Реферальная система Fonana позволяет пользователям приглашать друзей и отслеживать свою реферальную сеть. Каждый пользователь с установленным никнеймом получает уникальную реферальную ссылку.

## Функциональность

### 1. Реферальные ссылки
- Формат: `https://fonana.me/{nickname}`
- Автоматически генерируется для пользователей с никнеймом
- При переходе по ссылке устанавливается cookie на 7 дней

### 2. Автоматическая привязка
- При регистрации нового пользователя проверяется наличие реферальной cookie
- Если cookie найдена, новый пользователь автоматически привязывается к рефереру

### 3. Страница рефералов
- Расположение: `/dashboard/referrals`
- Отображает:
  - Реферальную ссылку с кнопкой копирования
  - Общую статистику (количество рефералов, активных криейторов, подписчиков)
  - Список всех приглашенных пользователей

### 4. API Endpoints

#### Получение рефералов
```
GET /api/user/referrals?userId={userId}
```
Возвращает список всех пользователей, приглашенных указанным пользователем.

## Техническая реализация

### База данных
В модель User добавлены поля:
- `referrerId`: String? - ID пользователя, который привел данного пользователя
- `referrer`: User relation - связь с пользователем-реферером
- `referrals`: User[] relation - список приглашенных пользователей

### Middleware
Файл `middleware.ts` отслеживает переходы по коротким ссылкам профилей и устанавливает cookie с никнеймом реферера.

### Процесс регистрации
При создании нового пользователя в `/api/user` проверяется cookie и устанавливается связь с реферером.

## Использование

### Для пользователей
1. Установите никнейм в настройках профиля
2. Перейдите в Dashboard → Referrals
3. Скопируйте свою реферальную ссылку
4. Поделитесь ссылкой с друзьями
5. Отслеживайте приглашенных пользователей в списке рефералов

### Для разработчиков
1. Миграция базы данных:
```bash
npx prisma migrate dev --name add-referral-system
```

2. Тестирование системы:
```bash
node scripts/test-referral-system.js
```

## Будущие улучшения
- Вознаграждения за рефералов
- Многоуровневая реферальная система
- Аналитика по реферальным конверсиям
- Реферальные промо-коды 