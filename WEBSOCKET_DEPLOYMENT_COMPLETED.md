# WebSocket Server Deployment - COMPLETED ‚úÖ

## –î–∞—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è: 27 –∏—é–Ω—è 2025

### –°—Ç–∞—Ç—É—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

‚úÖ **WebSocket-—Å–µ—Ä–≤–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ**

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### 1. WebSocket Server
- **–ü–æ—Ä—Ç**: 3002
- **–ü—Ä–æ—Ü–µ—Å—Å**: fonana-ws (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ PM2)
- **–ü—É—Ç—å –∫ —Å–µ—Ä–≤–µ—Ä—É**: `/var/www/fonana/websocket-server`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL (–ø–æ–¥–∫–ª—é—á–µ–Ω–∞)
- **Redis**: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (single server mode)

#### 2. Nginx Configuration
- **WebSocket –ø—É—Ç—å**: `/ws` ‚Üí `localhost:3002`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤**: `/etc/nginx/sites-available/fonana`
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: location /ws —Ä–∞–∑–º–µ—â–µ–Ω –ü–ï–†–ï–î location /

#### 3. PM2 Processes
```bash
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id ‚îÇ name         ‚îÇ mode    ‚îÇ pid      ‚îÇ uptime ‚îÇ status    ‚îÇ cpu      ‚îÇ mem      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 0  ‚îÇ fonana       ‚îÇ cluster ‚îÇ 1910016  ‚îÇ 2m     ‚îÇ online    ‚îÇ 0%       ‚îÇ 57.1mb   ‚îÇ
‚îÇ 1  ‚îÇ fonana-ws    ‚îÇ fork    ‚îÇ 1911338  ‚îÇ 12s    ‚îÇ online    ‚îÇ 0%       ‚îÇ 75.0mb   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### WebSocket Connection Test
```javascript
// Test successful connection
const ws = new WebSocket('wss://fonana.me/ws');
ws.onopen = () => console.log('Connected!');
// Result: ‚úÖ Connected
```

#### Server Response
```
‚úÖ Connected to WebSocket server
üîå Connection closed. Code: 1008, Reason: Unauthorized
```
*–ó–∞–∫—Ä—ã—Ç–∏–µ —Å –∫–æ–¥–æ–º 1008 (Unauthorized) - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è*

### –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ API endpoints

–í—Å–µ API endpoints –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å WebSocket —Å–æ–±—ã—Ç–∏—è–º–∏:

1. **–ü–æ—Å—Ç—ã** (`/api/posts`)
   - `post_created` - –Ω–æ–≤—ã–π –ø–æ—Å—Ç —Å–æ–∑–¥–∞–Ω
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º

2. **–õ–∞–π–∫–∏** (`/api/posts/[id]/like`)
   - `post_liked` / `post_unliked` - –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–∞–π–∫–æ–≤
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∞–º

3. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** (`/api/posts/[id]/comments`)
   - `comment_added` - –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∞–º –∏ –ø—Ä–∏ –æ—Ç–≤–µ—Ç–∞—Ö

4. **–ü–æ–¥–ø–∏—Å–∫–∏** (`/api/subscriptions/process-payment`)
   - `new_subscription` - –Ω–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞—Ç–µ–ª—è–º

5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** (`/api/user/notifications`)
   - `notification` - –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   - `notification_read` - –ø—Ä–æ—á–∏—Ç–∞–Ω–æ
   - `notifications_cleared` - –æ—á–∏—â–µ–Ω—ã

6. **–ß–∞–µ–≤—ã–µ** (`/api/tips`)
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è–º

### –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
pm2 status

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
pm2 logs fonana-ws

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ WebSocket —Å–µ—Ä–≤–µ—Ä–∞
pm2 restart fonana-ws

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 monit
```

### –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

- `/var/www/fonana/websocket-server/` - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è WebSocket —Å–µ—Ä–≤–µ—Ä–∞
- `/var/www/fonana/websocket-server/.env` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `/etc/nginx/sites-available/fonana` - Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `/root/.pm2/logs/fonana-ws-*.log` - –ª–æ–≥–∏ PM2

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–∫–ª—é—á–∏—Ç—å Redis –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. ‚úÖ Prisma –∫–ª–∏–µ–Ω—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ø—É—Ç—å –∏–º–ø–æ—Ä—Ç–∞
2. ‚úÖ DATABASE_URL - –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ .env
3. ‚úÖ Nginx –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - location /ws –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤—ã—à–µ location /
4. ‚úÖ PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - WebSocket —Å–µ—Ä–≤–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º

## –†–µ–∑—É–ª—å—Ç–∞—Ç: WebSocket-—Å–µ—Ä–≤–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ 